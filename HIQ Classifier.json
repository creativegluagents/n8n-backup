{"createdAt":"2025-07-30T06:12:00.195Z","updatedAt":"2025-08-11T12:46:43.878Z","id":"kCChtEurzPCgPyET","name":"HIQ Classifier","active":true,"isArchived":false,"nodes":[{"parameters":{"respondWith":"json","responseBody":"={{ $json }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[656,624],"id":"9dff3fbe-4122-4645-8c8e-16d76cc4099e","name":"Respond to Webhook1"},{"parameters":{"httpMethod":"POST","path":"23145b04-8328-41c1-b417-ef201e806dd7","responseMode":"responseNode","options":{"binaryPropertyName":"data"}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-1872,624],"id":"209bf1b1-74cd-4f6c-959e-7f5eeb89503b","name":"Webhook","webhookId":"23145b04-8328-41c1-b417-ef201e806dd7"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[-608,624],"id":"75d1c692-1042-490a-853d-afa6c82baad6","name":"Aggregate1"},{"parameters":{"workflowId":{"__rl":true,"value":"m09qUo4o1a7QMG1C","mode":"list","cachedResultName":"5. EPA Rule Book"},"workflowInputs":{"mappingMode":"defineBelow","value":{"report":"={{ $('Extract from File1').item.json.text }}"},"matchingColumns":["report"],"schema":[{"id":"report","displayName":"report","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-144,624],"id":"d05705e9-6469-4ff0-a4ba-33c7e7d29075","name":"EPA rule book"},{"parameters":{"operation":"pdf","binaryPropertyName":"data0","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1600,624],"id":"dd929a40-eb0e-4ac1-a6cc-50ea7199f860","name":"Extract from File1"},{"parameters":{"workflowId":{"__rl":true,"value":"YSGCDKWlU7ZSKMaF","mode":"list","cachedResultName":"Document checker"},"workflowInputs":{"mappingMode":"defineBelow","value":{"text":"={{ $('Extract from File1').item.json.text }}"},"matchingColumns":["text"],"schema":[{"id":"text","displayName":"text","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"chatId","displayName":"chatId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-1296,624],"id":"e75b17f9-4b81-41ad-9bcd-d23e91e959d7","name":"Document Checker"},{"parameters":{"workflowId":{"__rl":true,"value":"E6CfMaZ66qZvypvI","mode":"list","cachedResultName":"2. Sample adequacy checker"},"workflowInputs":{"mappingMode":"defineBelow","value":{"text":"={{ $('Extract from File1').item.json.text }}"},"matchingColumns":["text"],"schema":[{"id":"text","displayName":"text","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-1088,624],"id":"19b18a57-5b06-44c5-a363-c3b2403e05ca","name":"Sample Adequacy"},{"parameters":{"workflowId":{"__rl":true,"value":"JgvyMhUYZKtkeTBh","mode":"list","cachedResultName":"3. Waste organizer"},"workflowInputs":{"mappingMode":"defineBelow","value":{"text":"={{ $('Extract from File1').item.json.text }}"},"matchingColumns":["text"],"schema":[{"id":"text","displayName":"text","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-864,624],"id":"54cff464-5f6c-44a6-8a00-1946437d64f0","name":"Waste Organiser"},{"parameters":{"workflowId":{"__rl":true,"value":"tqrgduXe2fkW7UrJ","mode":"list","cachedResultName":"4. Danger Detector"},"workflowInputs":{"mappingMode":"defineBelow","value":{"report":"={{ $('Extract from File1').item.json.text }}","list":"={{ $json.data }}"},"matchingColumns":["text","toJsonString"],"schema":[{"id":"list","displayName":"list","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":false},{"id":"report","displayName":"report","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-368,624],"name":"Danger Detector","id":"a7fe15dd-9d9b-4fa8-b740-aa84b2cdeb8e"},{"parameters":{"workflowId":{"__rl":true,"value":"R8n4cQb3n42mwWTf","mode":"list","cachedResultName":"6. The Recycling Hunter"},"workflowInputs":{"mappingMode":"defineBelow","value":{"report":"={{ $('Extract from File1').item.json.text }}"},"matchingColumns":["report"],"schema":[{"id":"report","displayName":"report","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[128,624],"id":"83f61487-9b20-4d98-a08e-577406660204","name":"Recycling Hunter"},{"parameters":{"jsCode":"const map = [\n  { key: 'Document Checker' },\n  { key: 'Sample Adequacy' },\n  { key: 'Waste Organiser' },\n  { key: 'Danger Detector' },\n  { key: 'EPA rule book' },\n  { key: 'Recycling Hunter' },\n];\n\n// --- helpers ---\nconst coerceBool = v =>\n  typeof v === 'boolean' ? v :\n  typeof v === 'string' ? (v.trim().toLowerCase() === 'true' ? true : v.trim().toLowerCase() === 'false' ? false : undefined) :\n  typeof v === 'number' ? (v === 1 ? true : v === 0 ? false : undefined) :\n  undefined;\n\nconst looksJson = s => typeof s === 'string' && ((s = s.trim()).startsWith('{') && s.endsWith('}')) || (s.startsWith('[') && s.endsWith(']'));\n\nfunction findPassed(v) {\n  if (v == null) return;\n  if (Array.isArray(v)) { for (const x of v) { const r = findPassed(x); if (typeof r === 'boolean') return r; } return; }\n  if (typeof v === 'object') {\n    if (Object.prototype.hasOwnProperty.call(v, 'passed')) {\n      const b = coerceBool(v.passed); if (typeof b === 'boolean') return b;\n    }\n    for (const k of Object.keys(v)) { const r = findPassed(v[k]); if (typeof r === 'boolean') return r; }\n  }\n}\n\nfunction normalize(input) {\n  const parseDeep = v => {\n    if (typeof v === 'string' && looksJson(v)) { try { v = JSON.parse(v); } catch {} }\n    if (Array.isArray(v)) return v.map(parseDeep);\n    if (v && typeof v === 'object') { const o = {}; for (const k of Object.keys(v)) o[k] = parseDeep(v[k]); return o; }\n    return v;\n  };\n\n  const stripAndUnwrap = v => {\n    if (Array.isArray(v)) return v.map(stripAndUnwrap);\n    if (v && typeof v === 'object') {\n      while (v && typeof v === 'object' && !Array.isArray(v)) {\n        const ks = Object.keys(v);\n        if (ks.length === 1 && (ks[0] === 'output' || ks[0] === 'data')) v = v[ks[0]]; else break;\n      }\n      if (Array.isArray(v)) return v.map(stripAndUnwrap);\n      if (v && typeof v === 'object') {\n        const o = {};\n        for (const k of Object.keys(v)) if (k !== 'passed') o[k] = stripAndUnwrap(v[k]);\n        return o;\n      }\n    }\n    return v;\n  };\n\n  let cur = input, prev;\n  for (let i = 0; i < 4; i++) {\n    prev = JSON.stringify(cur);\n    cur = stripAndUnwrap(parseDeep(cur));\n    if (JSON.stringify(cur) === prev) break;\n  }\n  if (typeof cur === 'string' && looksJson(cur)) { try { cur = JSON.parse(cur); } catch {} cur = stripAndUnwrap(cur); }\n  return cur;\n}\n\nfunction collect(nodeName) {\n  try {\n    const items = $items(nodeName, 0, 0) || [];\n    if (!items.length) return { passed: false, output: { note: 'no output' } };\n    const raw = items.length === 1 ? items[0].json : items.map(i => i.json);\n    const passed = findPassed(raw);\n    return { passed: typeof passed === 'boolean' ? passed : false, output: normalize(raw) };\n  } catch {\n    return { passed: false, output: { error: `No data from node \"${nodeName}\"` } };\n  }\n}\n\n// --- run ---\nconst result = {};\nlet passCount = 0;\nfor (const { key } of map) {\n  const r = collect(key);\n  if (r.passed) passCount++;\n  result[key] = r; // key is node name now\n}\nresult.summary = {\n  total_nodes: map.length,\n  passed_count: passCount,\n  failed_count: map.length - passCount,\n  all_passed: passCount === map.length,\n};\n\nreturn [{ json: result }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[384,624],"id":"f12692fa-e8b2-415d-a2e2-7efc00a0e7de","name":"Code"},{"parameters":{"content":"Extracting the report","height":240,"width":192},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1648,544],"id":"42346cbc-dfa5-483d-984c-71872d40101f","name":"Sticky Note"},{"parameters":{"content":"Agents","height":240,"width":1696,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1392,544],"id":"491be04d-ce1f-4767-b81b-46bd0c4d0392","name":"Sticky Note1"},{"parameters":{"content":"Formatting the responses","height":240,"width":192,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[336,544],"id":"a9b38e3c-1881-4d5c-bd6a-c6af53946a65","name":"Sticky Note2"},{"parameters":{"content":"Responding","height":240,"width":288,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[560,544],"id":"3a33cfac-9997-45d3-9961-c4436ba9fc52","name":"Sticky Note3"}],"connections":{"Aggregate1":{"main":[[{"node":"Danger Detector","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Extract from File1","type":"main","index":0}]]},"EPA rule book":{"main":[[{"node":"Recycling Hunter","type":"main","index":0}]]},"Extract from File1":{"main":[[{"node":"Document Checker","type":"main","index":0}]]},"Document Checker":{"main":[[{"node":"Sample Adequacy","type":"main","index":0}]]},"Sample Adequacy":{"main":[[{"node":"Waste Organiser","type":"main","index":0}]]},"Waste Organiser":{"main":[[{"node":"Aggregate1","type":"main","index":0}]]},"Danger Detector":{"main":[[{"node":"EPA rule book","type":"main","index":0}]]},"Recycling Hunter":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"6dd510a6-ff2b-4499-b1cd-6b556601eac0","triggerCount":1,"tags":[]}