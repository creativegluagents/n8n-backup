{"createdAt":"2025-06-13T09:13:27.120Z","updatedAt":"2025-06-13T09:19:19.290Z","id":"VdjmPrLx4uEkNBhN","name":"My workflow 18","active":false,"isArchived":false,"nodes":[{"parameters":{"updates":["*"],"additionalFields":{}},"id":"1a2ebdf0-7cf0-402e-80b5-de7e122bd3d4","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","position":[-1220,580],"webhookId":"51942fbb-ca0e-4ec4-9423-5fcc7d3c4281","typeVersion":1,"credentials":{"telegramApi":{"id":"9UDTcxGhNUDvWhgx","name":"typing test bot"}}},{"parameters":{"dataType":"string","value1":"={{ $json.message?.text }}","rules":{"rules":[{"operation":"notStartsWith","value2":"/"},{"operation":"startsWith","value2":"/start","output":1},{"operation":"startsWith","value2":"=/image ","output":2}]},"fallbackOutput":3},"id":"ccece3d2-9c03-481a-82b4-50b46f0a8063","name":"CheckCommand","type":"n8n-nodes-base.switch","position":[-40,600],"typeVersion":1},{"parameters":{"content":"## Error fallback for unsupported commands","height":231.22373949579838,"width":316.1071428571428},"id":"0dc5af4b-c75c-41fc-9c96-e5669dfc340d","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[360,840],"typeVersion":1},{"parameters":{"values":{"number":[{"name":"model_temperature","value":0.8},{"name":"token_length","value":500}],"string":[{"name":"system_command","value":"=You are a friendly chatbot. User name is {{ $json?.message?.from?.first_name }}. User system language is {{ $json?.message?.from?.language_code }}. First, detect user text language. Next, provide your reply in the same language. Include several suitable emojis in your answer."},{"name":"bot_typing","value":"={{ $json?.message?.text.startsWith('/image') ? \"upload_photo\" : \"typing\" }}"}]},"options":{}},"id":"a5c1cce7-ddd1-44d3-b3f6-4080ec1c1a0a","name":"Settings","type":"n8n-nodes-base.set","position":[-860,580],"typeVersion":2},{"parameters":{"content":"## Chatbot mode by default\n### (when no command is provided)","height":233,"width":330.5019024637719},"id":"48fd3820-79b5-474e-aebc-4c9f8f386735","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1},{"parameters":{"content":"## Welcome message\n### /start","height":219.892857142857,"width":330.7863484403046},"id":"7fc4166b-ea4a-4753-a2db-e9167f054ecc","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[0,260],"typeVersion":1},{"parameters":{"resource":"chat","model":"gpt-4","prompt":{"messages":[{"role":"system","content":"={{ $json.system_command }}"},{"content":"={{ $json.message.text }}"}]},"options":{"maxTokens":"={{ $json.token_length }}","temperature":"={{ $json.model_temperature }}"},"requestOptions":{}},"id":"dea98525-52c9-4fbf-9d6b-16e141b67f45","name":"Chat_mode","type":"n8n-nodes-base.openAi","position":[320,80],"typeVersion":1,"credentials":{"openAiApi":{"id":"L5UoHZfkBt6nb3Ad","name":"OpenAi Account"}}},{"parameters":{"resource":"chat","prompt":{"messages":[{"role":"system","content":"={{ $json.system_command }}"},{"content":"=This is the first message from a user. Please welcome a new user in `{{ $json.message.from.language_code }}` language"}]},"options":{"maxTokens":"={{ $json.token_length }}","temperature":"={{ $json.model_temperature }}"},"requestOptions":{}},"id":"fdba01a2-6c1e-414b-84f6-c1ba558b53a3","name":"Greeting","type":"n8n-nodes-base.openAi","position":[320,320],"typeVersion":1,"credentials":{"openAiApi":{"id":"L5UoHZfkBt6nb3Ad","name":"OpenAi Account"}}},{"parameters":{"chatId":"={{ $('Settings').first().json.message.from.id }}","text":"={{ $json.message.content }}","additionalFields":{"parse_mode":"Markdown"}},"id":"1f7f0e04-e707-433f-a52f-ffb6c0f3f78c","name":"Text reply","type":"n8n-nodes-base.telegram","position":[680,200],"typeVersion":1,"webhookId":"e7214ec5-cccf-4231-8cf2-4915f3dd362b","credentials":{"telegramApi":{"id":"9UDTcxGhNUDvWhgx","name":"typing test bot"}}},{"parameters":{"operation":"sendChatAction","chatId":"={{ $json.message.from.id }}","action":"={{ $json.bot_typing }}"},"id":"c5397dfd-2fd5-491b-acf4-85af58ff7bba","name":"Send Typing action","type":"n8n-nodes-base.telegram","position":[-660,720],"typeVersion":1,"webhookId":"43bfd6c1-9268-4b5b-b9e1-b79b1e244c4e","credentials":{"telegramApi":{"id":"9UDTcxGhNUDvWhgx","name":"typing test bot"}}},{"parameters":{"mode":"chooseBranch"},"id":"d575c960-7777-4d55-940e-51973f346c4a","name":"Merge","type":"n8n-nodes-base.merge","position":[-500,600],"typeVersion":2.1},{"parameters":{"content":"## Create an image\n### /image + request","height":233.8785714285713,"width":329.7428571428562},"id":"22a41486-cb8f-4883-8af8-d4fcd2bbea8f","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[0,520],"typeVersion":1},{"parameters":{"resource":"image","prompt":"={{ $json.message.text.split(' ').slice(1).join(' ') }}","responseFormat":"imageUrl","options":{"n":1,"size":"512x512"},"requestOptions":{}},"id":"8c56184b-9f73-44b0-90c2-d19f9962f864","name":"Create an image","type":"n8n-nodes-base.openAi","position":[320,600],"typeVersion":1,"credentials":{"openAiApi":{"id":"L5UoHZfkBt6nb3Ad","name":"OpenAi Account"}}},{"parameters":{"chatId":"={{ $json.message.from.id }}","text":"=Sorry, {{ $json.message.from.first_name }}! This command is not supported yet. Please type some text to a chat bot or try this command:\n/image \\[your prompt]\n\nEnter the command, then space and provide your request. Example:\n\n`/image a picture or a cute little kitten with big eyes. Miyazaki studio ghibli style`","additionalFields":{"parse_mode":"Markdown"}},"id":"82b70908-fc82-453e-95df-5156042ae035","name":"Send error message","type":"n8n-nodes-base.telegram","position":[680,900],"typeVersion":1,"webhookId":"c26dfcb5-f8fe-4cdb-b9ba-6a1c24aac5ac","credentials":{"telegramApi":{"id":"9UDTcxGhNUDvWhgx","name":"typing test bot"}}},{"parameters":{"operation":"sendPhoto","chatId":"={{ $('Settings').first().json.message.from.id }}","file":"={{ $json.url }}","additionalFields":{}},"id":"b5b41978-c413-4775-b9ba-60f4fadaa580","name":"Send image","type":"n8n-nodes-base.telegram","position":[680,600],"typeVersion":1,"webhookId":"ff63425b-1c2c-44be-9053-3f94aa7bff03","credentials":{"telegramApi":{"id":"9UDTcxGhNUDvWhgx","name":"typing test bot"}}},{"parameters":{"values":{"string":[{"name":"message.text","value":"={{ $json?.message?.text || \"\" }}"}]},"options":{"dotNotation":true}},"id":"d75517e2-5436-4339-a03c-30d5fe3d0f31","name":"PreProcessing","type":"n8n-nodes-base.set","position":[-1040,580],"typeVersion":2},{"parameters":{},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-280,600],"id":"c9806093-6c3f-49cb-bd14-bced8a9e8a9a","name":"Wait","webhookId":"f12d2d8d-db50-4c18-90ae-c5dfb0ae69a3"}],"connections":{"Telegram Trigger":{"main":[[{"node":"PreProcessing","type":"main","index":0}]]},"CheckCommand":{"main":[[{"node":"Chat_mode","type":"main","index":0}],[{"node":"Greeting","type":"main","index":0}],[{"node":"Create an image","type":"main","index":0}],[{"node":"Send error message","type":"main","index":0}]]},"Settings":{"main":[[{"node":"Send Typing action","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"Chat_mode":{"main":[[{"node":"Text reply","type":"main","index":0}]]},"Greeting":{"main":[[{"node":"Text reply","type":"main","index":0}]]},"Send Typing action":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Create an image":{"main":[[{"node":"Send image","type":"main","index":0}]]},"PreProcessing":{"main":[[{"node":"Settings","type":"main","index":0}]]},"Wait":{"main":[[{"node":"CheckCommand","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"63298006-4431-4de6-8d59-69d4754a549a","triggerCount":1,"tags":[]}