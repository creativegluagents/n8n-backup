{"createdAt":"2025-07-17T12:09:12.768Z","updatedAt":"2025-07-24T06:11:31.145Z","id":"l9oDhrgBbMLOjRTG","name":"MCP Server-Postgres Ryzosphere","active":true,"isArchived":false,"nodes":[{"parameters":{"public":true,"mode":"webhook","options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-288,240],"id":"35d56a32-e0dd-40d2-b25b-1e2fb38cfac2","name":"When chat message received","webhookId":"16ee3945-e238-4682-98e5-93d077c62686"},{"parameters":{},"type":"n8n-nodes-mcp.mcpClientTool","typeVersion":1,"position":[144,544],"id":"d906e0f1-642b-4940-af25-68933c55abe6","name":"MCP Tools List","credentials":{"mcpClientApi":{"id":"JgyK0pYyhvnGr33L","name":"Supabase tool"}}},{"parameters":{"operation":"executeTool","toolName":"={{ $fromAI('tool_name') }}","toolParameters":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Tool_Parameters', ``, 'json') }}"},"type":"n8n-nodes-mcp.mcpClientTool","typeVersion":1,"position":[400,544],"id":"2f504a1c-a303-47fd-bb4c-2b1c7842dc0c","name":"MCP Execute Tool","credentials":{"mcpClientApi":{"id":"JgyK0pYyhvnGr33L","name":"Supabase tool"}},"onError":"continueRegularOutput"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-288,544],"id":"3f5aac3e-ac21-48e0-8b7e-87e943b4c902","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"content":"## Trigger\n","height":260,"width":352},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-336,160],"id":"b19fd6e2-2c1b-4cec-8768-19526e082821","name":"Sticky Note"},{"parameters":{"content":"## AI Agent\n","height":260,"width":520,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[32,160],"id":"e2d906ea-e3c3-42dc-a0df-de7464cd35f4","name":"Sticky Note1"},{"parameters":{"content":"## Brain And Memory\n","height":276,"width":352,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-336,432],"id":"5303ba69-7936-4155-a2cd-680e6419b390","name":"Sticky Note2"},{"parameters":{"promptType":"define","text":"={{ $('When chat message received').item.json.message ||$('When chat message received').item.json.chatInput }}","options":{"systemMessage":"=You are Ryzosphere AI Assistant ‚Äî an expert in querying PostgreSQL databases via MCP Server. You help users explore and analyze their data inside the **public** schema using MCP tools.\n\n---\nGreeting:\nGreet users with this message (no tool calls during greeting):\n\"Hello! I‚Äôm Ryzosphere AI Assistant ‚Äî here to help you get the answers you need. What can I help you with today?\"\n\n-------\nDatabase Tables and filed details \n{{ $json.data.toJsonString() }}\n\nPlease use above mentioned filed and table name if you have confusion in user query and alwys double check the table and filed name correct them based on aboeve db schema\n\n---\nInstructions:\n- Always call **MCP List tools** before any action.\n- Use **MCP Execute tool** for operations; follow schema carefully.\n- Use pagination when supported.\n- Always query from the **public** schema only.\n- If using **Supabase MCP LIST Tool2**, set schema as `public` always.\n- Do not Call tools Multiple times try to get output in one single call always\n\n---\nüì¶ Output Format:\n- Always return results in a clear, readable format.\n- For lists, use bullet points like:\n  ‚Ä¢ Product: Apple iPhone ‚Äì Category: Mobile\n- Use section headers (e.g., üîç Search Results) to make content easier to scan.\n- Avoid using raw Markdown tables or pipes `|` unless the UI supports them.\n- If the list is long, show only the top 5‚Äì10 results and mention how many more exist.\n- If no results are found, say:\n  \"I couldn‚Äôt find any matching records. Please try refining your search.\"\n\n---\nError Handling:\n- Retry failed tool calls up to 3 times with resolution attempts before notifying user.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[208,240],"id":"7c31ea33-6c86-4064-9cdb-da941cb0f424","name":"AI Agent"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $now.format('yyyy-MM-dd') }}"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-112,544],"id":"c1192a80-fdf5-4021-9c90-bb48c817b226","name":"Simple Memory"},{"parameters":{"content":"## MCP Postgres Server\n\n","height":276,"width":520,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[32,432],"id":"2e787248-183f-49cd-b8e1-1a3d285b871b","name":"Sticky Note3"},{"parameters":{"operation":"executeQuery","query":"SELECT \n  table_name,\n  STRING_AGG(column_name || ' (' || data_type || ')', ', ') AS columns\nFROM information_schema.columns\nWHERE table_schema = 'public'\nGROUP BY table_name\nORDER BY table_name;\n\n","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-128,240],"id":"63d17688-bbc4-4d20-9187-5365d63e8188","name":"Execute a SQL query","credentials":{"postgres":{"id":"UfKfi2qBkHyT7wJm","name":"Postgres account 2"}}},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[64,240],"id":"47e509d1-f765-4cb6-80f9-1e03f0b6aae1","name":"Aggregate"}],"connections":{"When chat message received":{"main":[[{"node":"Execute a SQL query","type":"main","index":0}]]},"MCP Tools List":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"MCP Execute Tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[]]},"Execute a SQL query":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"fc23f7ce-4c88-48f1-abe1-d9f612d97b39","triggerCount":1,"tags":[{"createdAt":"2025-07-18T05:53:47.839Z","updatedAt":"2025-07-18T05:53:47.839Z","id":"yWarWQQwSVvPojGd","name":"MCP"}]}