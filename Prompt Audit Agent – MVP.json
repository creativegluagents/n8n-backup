{"createdAt":"2025-08-14T16:35:07.650Z","updatedAt":"2025-08-17T04:05:55.604Z","id":"uw97BCmjPO4GgO7U","name":"Prompt Audit Agent â€“ MVP","active":false,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"prompt-audit","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[16,-480],"id":"3e26b300-6000-4b7b-bbdb-a8334787ea47","name":"Webhook","webhookId":"82941a55-e4d1-4f2d-803c-ee5a48693615"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"GPT-4O"},"messages":{"values":[{"content":"="}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[640,-368],"id":"4489dcab-7879-41c1-9619-8aa851683870","name":"Message a model","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"jsCode":"// Hardcoded standard\nconst standard = {\n  \"name\": \"Glu Prompting Standard v1.0\",\n  \"version\": \"1.0\",\n  \"checks\": [\n    { \"id\": \"has_roles\", \"label\": \"Has Roles\", \"pattern\": \"(?is)\\\\bSystem\\\\b.*\\\\bDeveloper\\\\b.*\\\\bUser\\\\b\" },\n    { \"id\": \"has_objective\", \"label\": \"Has Objective\", \"pattern\": \"(?i)objective\\\\s*:\" },\n    { \"id\": \"has_success_criteria\", \"label\": \"Has Success Criteria\", \"pattern\": \"(?i)success criteria\" },\n    { \"id\": \"has_safety\", \"label\": \"Has Safety\", \"pattern\": \"(?i)(refus|safe-?completion)\" }\n  ]\n};\n\n// Get improved prompt from Message a Model output\nconst improvedPrompt = $json.message?.content || \"\";\n\n// Get original prompt from Webhook input\nconst originalPrompt = $items(\"Webhook\")[0].json.body?.prompt || \"\";\n\n// Run checks\nconst checks = (standard.checks || []).map(chk => {\n  const flagMatch = chk.pattern.match(/^\\(\\?([a-z]+)\\)/i);\n  let flags = \"\";\n  let pattern = chk.pattern;\n\n  if (flagMatch) {\n    flags = flagMatch[1];\n    pattern = pattern.replace(/^\\(\\?[a-z]+\\)/i, \"\");\n  }\n\n  const regex = new RegExp(pattern, flags);\n  return {\n    id: chk.id,\n    label: chk.label || chk.id,\n    pass: regex.test(improvedPrompt)\n  };\n});\n\nreturn [{\n  json: {\n    original_prompt: originalPrompt,\n    improved_prompt: improvedPrompt,\n    checks,\n    metadata: {\n      timestamp: new Date().toISOString(),\n      workflow_name: \"Prompt Audit Agent\"\n    }\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[816,-160],"id":"1ed01568-48f2-447f-b0c1-14ede545ce62","name":"Run Compliance Checks"},{"parameters":{"respondWith":"allIncomingItems","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[1104,-112],"id":"6cc2ed86-b824-4673-bae3-864295fad6b9","name":"Respond to Webhook"},{"parameters":{"operation":"get","documentURL":"https://docs.google.com/document/d/1u9dMufujQLfoE_xjR_NiU-vuErS2j734N4GUSP5BuFA/edit?tab=t.0"},"type":"n8n-nodes-base.googleDocs","typeVersion":2,"position":[224,-272],"id":"755db7d2-6981-4c66-916a-cc6e0b60d858","name":"Get a document","alwaysOutputData":true,"retryOnFail":true,"waitBetweenTries":100,"credentials":{"googleDocsOAuth2Api":{"id":"STmn8P4Z9S8flw5l","name":"Vaibhava"}}},{"parameters":{"assignments":{"assignments":[{"id":"22545fb1-0ade-4494-8328-b0e6fb686da9","name":"Keep Prompt","value":"={{$json.body.prompt}}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[224,-480],"id":"d71d64b4-e60f-4946-92cb-cf64dea214a7","name":"Edit Fields"},{"parameters":{"jsCode":"// Pull the user prompt (from your earlier Set node or webhook body)\nconst prompt =\n  $json.prompt ??\n  $node[\"Keep Prompt\"]?.json?.prompt ??\n  $json.body?.prompt ??\n  \"\";\n\n// Read the template text returned by \"Get a document\"\nconst template = String($json.content ?? \"\");\n\nconst final_text = template\n  .replace(/\\\\n/g, '\\n')       // turn \\n into real newlines (safe even if already real)\n  .split('{{PROMPT}}')         // OR .split('{{$json.body.prompt}}')\n  .join(String(prompt));\n\nreturn [\n  {\n    json: {\n      ...$json,\n      final_text,\n    },\n  },\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[384,-272],"id":"d7005683-6316-487b-9781-024af1e34b39","name":"Code"}],"connections":{"Webhook":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Message a model":{"main":[[]]},"Run Compliance Checks":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Get a document":{"main":[[{"node":"Code","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Get a document","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"e81365d6-a7b5-49a0-9d43-52a11b490ab2","triggerCount":0,"tags":[]}