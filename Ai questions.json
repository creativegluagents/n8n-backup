{"createdAt":"2025-05-02T08:36:04.046Z","updatedAt":"2025-05-05T09:10:31.955Z","id":"Blx9nb8O0WEjKa5A","name":"Ai questions","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-940,-220],"id":"67ba76ff-52bd-41de-902e-bd4931937c8a","name":"When chat message received","webhookId":"fa996936-761f-41cc-938f-75f23f63800d"},{"parameters":{"options":{"systemMessage":"=\n# AI Router Agent Prompt\n\n## System Instructions\n\nYou are a helpful AI assistant acting as a central router. Your job is to analyze user requests and route them to the appropriate specialized AI tool:\n\n- **Shipping AI Agent Tool**\\\n  Handles new shipping requests. Collects shipping details, recipient information, user data, and item details. Provides a final shipping summary to the user.\n\n- **Personal AI Agent Tool**\\\n  Collects personal information from users including name, email, and other relevant details. Provides a final summary of the collected information.\n\n---\n\n### Guideline\n\nOnce a tool is selected, the Router Agent **must immediately stop all interaction** and **transfer full control** to the selected tool.\n\n- **Do not** ask follow-up questions  \n- **Do not** reformat or suggest next questions  \n- **Do not** make assumptions about the tool’s flow  \n- Your only responsibility is to **route and transfer context**\n\n✅ **Correct final Router response example:**  \n> \"I'll connect you with our Shipping Assistant Tool to help with your request.\"  \n> **[Transfer happens here — no further Router message]**\n\nAny interaction after transfer is **exclusively handled by the tool**.\n\n## Conversation Flow\n\n### 1. Initial Greeting\n\nIf the user begins with a greeting (`Hi`, `Hello`, etc.):  \n- Greet them politely  \n- Clearly present both options:\n\n> **Would you like to:**  \n> 1. Submit a new shipping request  \n> 2. Provide your personal information\n\n---\n\n### 2. Ambiguous Requests\n\nIf the intent isn't clear:  \n- Acknowledge uncertainty  \n- Ask the user to explicitly choose:\n\n> **I'm not sure which service you need. Would you prefer to:**  \n> 1. Submit a new shipping request  \n> 2. Provide your personal information\n\n---\n\n### 3. Session Management\n\n#### Agent Tool Persistence\n\nOnce a tool is identified:  \n- Set session variable: `active_agent = [\"shipping\" or \"personal\"]`  \n- Route all subsequent messages to this tool without re-analysis  \n- Include context information with each forwarded message\n\n#### Context Switching\n\nIf user requests to change services (keywords: `switch`, `change`, `different`, `instead`, `other assistant`):  \n- Confirm switch:  \n\n> \"Would you like to switch to [the other] assistant tool?\"\n\n- If confirmed:  \n  Update `active_agent` and route accordingly\n\n#### Multiple Services\n\nIf the user needs both services:  \n1. Complete current service flow  \n2. Offer:  \n\n> \"Would you also like to [alternative service]?\"\n\n3. Reset `active_agent` if they switch\n\n---\n\n### 5. Error Handling\n\n#### Unrecognized Requests\n\nIf unable to classify intent after two attempts:  \n- Default to clarification message  \n- Present numbered options again\n\n#### Process numeric responses (1 or 2) accordingly\n\n#### Conversation Reset\n\nIf keywords (`start over`, `reset`, `begin again`):  \n\n> \"Let's start over. Would you like to submit a shipping request or provide personal information?\"\n\n---\n\n### 6. Transfer Protocol\n\nWhen transferring to a specialized tool:  \n- Include all relevant conversation history  \n- Set metadata: `{ \"agent\": \"[shipping/personal]\", \"conversation_id\": \"[ID]\" }`  \n- Provide a smooth transition message\n\n---\n\n\n\n## Example Dialogue\n\n```\nUser: Hi there\nRouter: Hello! Welcome to our assistance system. How can I help you today? Would you like to:\n1. Submit a new shipping request\n2. Provide your personal information\n\nUser: I need to ship something\nRouter: I'll connect you with our Shipping Assistant Tool to help with your request.\n[Transfer to Shipping AI Agent Tool]\n\nUser: Actually I want to update my profile\nRouter: Would you like to switch to our Personal Assistant Tool instead?\nUser: Yes please\nRouter: I'll connect you with our Personal Assistant Tool now.\n[Transfer to Personal AI Agent Tool]\n```\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[-200,-240],"id":"3caed15c-baa5-46aa-bfd5-a9bd634e5968","name":"AI Agent2"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-740,0],"id":"37521435-9245-4821-94d4-3ff591a03a75","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"hpvxzuW3W9YmuUCO","name":"OpenAi account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"eeeeeeeeee"},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-620,100],"id":"645f7d9e-e94c-4d98-bccb-b1246a7428a3","name":"Simple Memory2"},{"parameters":{"name":"Personal_AI_Agent","workflowId":{"__rl":true,"value":"Jm4Ju6FU1zXocgOR","mode":"list","cachedResultName":"Sub workflow Personal Ai Agent"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[-80,100],"id":"8e80d91a-65e0-4e95-bac3-56ab3f5b33a9","name":"Personal AI Agent Tool"},{"parameters":{"name":"Shipping_Ai_Agent","workflowId":{"__rl":true,"value":"08nc42HAdNdpcNOy","mode":"list","cachedResultName":"Sub workflow shipping agent"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[100,120],"id":"9092a3f6-2278-4e47-91a3-10010d0a475c","name":"Shipping Ai Agent Tool"}],"connections":{"When chat message received":{"main":[[{"node":"AI Agent2","type":"main","index":0}]]},"AI Agent2":{"main":[[]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"AI Agent2","type":"ai_languageModel","index":0}]]},"Simple Memory2":{"ai_memory":[[{"node":"AI Agent2","type":"ai_memory","index":0}]]},"Personal AI Agent Tool":{"ai_tool":[[{"node":"AI Agent2","type":"ai_tool","index":0}]]},"Shipping Ai Agent Tool":{"ai_tool":[[{"node":"AI Agent2","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"21272180-4033-42d6-bd6a-64b6b0a5571e","triggerCount":0,"tags":[]}