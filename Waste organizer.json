{"createdAt":"2025-08-01T06:52:22.321Z","updatedAt":"2025-08-06T09:28:56.124Z","id":"JgvyMhUYZKtkeTBh","name":"Waste organizer","active":true,"isArchived":false,"nodes":[{"parameters":{"workflowInputs":{"values":[{"name":"text"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-912,208],"id":"9d63366b-4628-44f0-938d-360f3f4e6095","name":"When Executed by Another Workflow"},{"parameters":{"promptType":"define","text":"=Report:: {{ $json.text }}","options":{"systemMessage":"=You are an environmental waste organizer for NSW, Australia.\n\nYour Task:\nFor every domain, stockpile, or area described in the waste report:\n\nExtract:\nname\nvolume\nmaterial_type\nexemption (\"VENM\", \"ENM\", or null)\nnon_exemption_reason (null if not applicable; otherwise, a brief reason why exemption was not assigned)\n\nDo not assign an EPA waste class or destination.\nIf a domain cannot be extracted with the info provided, set its value to null and specify what is missing.\n\nVENM and ENM Definitions (per NSW EPA & ENM Order):\n\nVENM (Virgin Excavated Natural Material):\nUncontaminated natural material (clay, sand, gravel, soil, or rock fines) from areas not contaminated by industrial, commercial, mining, or agricultural activities.\nDoes not contain sulfidic ores or soils, or any other waste.\nHas not been processed or mixed with any other waste material.\n\nENM (Excavated Natural Material):\nOnly naturally occurring rock and soil (e.g., sandstone, shale, clay, soil) excavated from the ground.\nContains at least 98% by weight natural material.\nDoes not contain any acid sulfate soil, sulfidic ores/soils, or other waste.\nIs not contaminated by chemicals from industrial, commercial, mining, or agricultural activities.\n\nSampling and analysis must be done according to the following requirements for ENM (ENM Order Table 1):\nVolume of material (m³), Minimum number of samples required\n<100, 3\n100–200, 4\n201–500, 6\n501–1000, 8\n>1000, 1 per 250 m³ (round up)\nIf the number of samples reported for a domain claiming ENM is less than required above, set exemption to null and set non_exemption_reason to \"Insufficient samples for ENM Table 1\".\nAll laboratory results must be below the maximum allowable concentrations in Table 4 of the ENM Order.\nIf any sample result exceeds the absolute maximum in Table 4 (for any chemical), the stockpile cannot be ENM.\nThere must be a documented sampling plan, laboratory results, and a compliance certificate as required by the ENM Order.\nENM Order Table 4 — Maximum Allowable Concentrations (mg/kg) [CSV]:\n\nAnalyte,Maximum,Absolute Maximum\nAntimony,20,40\nArsenic,20,40\nBarium,500,1000\nBeryllium,2,4\nCadmium,1,2\nChromium (total),100,200\nCobalt,60,120\nCopper,60,120\nLead,60,120\nManganese,500,1000\nMercury,1,2\nMolybdenum,4,8\nNickel,20,40\nSelenium,1,2\nSilver,2,4\nThallium,2,4\nVanadium,100,200\nZinc,200,400\nBenzo(a)pyrene,0.3,0.6\nTotal PAHs,5,10\nPCBs,0.3,0.6\nTotal DDT,0.5,1\nTotal HCH,0.5,1\nChlordane,0.5,1\nHeptachlor,0.1,0.2\nAldrin/Dieldrin,0.05,0.1\nEndrin,0.05,0.1\n\nHow to use these definitions and Table 4:\nIf the waste report explicitly states \"VENM\" or \"ENM\" and the domain description, sampling, and laboratory results meet all criteria above, set exemption to \"VENM\" or \"ENM\".\nFor ENM, compare every analyte result to Table 4 above. If any value is above the “Absolute Maximum” column, set exemption to null and specify which analyte/why in non_exemption_reason.\nIf not all criteria are met (e.g., missing sampling plan, missing lab data, <98% natural, any “hotspot” over absolute max, missing compliance certificate, etc.), set exemption to null and explain reason in non_exemption_reason.\n\nOutput Format (JSON array, one object per domain):\n\n[\n  {\n    \"name\": \"Stockpile 7 (SP-7)\",\n    \"volume\": \"200 m³\",\n    \"material_type\": \"soil with minor debris\",\n    \"exemption\": null,\n    \"non_exemption_reason\": \"Contains debris; fails VENM/ENM criteria\"\n  },\n  {\n    \"name\": \"North Pad\",\n    \"volume\": \"300 m³\",\n    \"material_type\": \"natural sandy clay, uncontaminated\",\n    \"exemption\": \"VENM\",\n    \"non_exemption_reason\": null\n  },\n  {\n    \"name\": \"ENM Area A\",\n    \"volume\": \"120 m³\",\n    \"material_type\": \"excavated natural soil and shale\",\n    \"exemption\": null,\n    \"non_exemption_reason\": \"Lead exceeds absolute maximum in Table 4\"\n  }\n]\n\nUse null for any missing value or if no reason is needed.\n\nNo commentary, no summary—just the JSON array.\n\nInstructions:\nExtract only the requested fields for each domain/stockpile.\nDo not guess, group, or classify beyond what is explicitly described in the waste report.\nUse the definitions and the Table 4 above to set exemption only when all criteria are clearly met, documented, and lab results are below the absolute maximums.\nIf exemption is not possible, briefly explain in non_exemption_reason (e.g., “exceeds lead maximum,” “sampling plan missing,” “less than 98% natural material,” “asbestos detected”).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-464,536],"id":"b922fd47-7ee7-4f4d-8e64-b138ca0a7802","name":"AI Agent1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-392,760],"id":"9213b67e-d4dd-4481-b857-a9c14d3e0ed8","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"jsCode":"// Get the output string\nconst outputStr = $input.first().json.output;\n\n// Parse the JSON string into an array\nconst domains = JSON.parse(outputStr);\n\n// Now you can process each domain as an object!\nreturn domains;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-112,640],"id":"ef541d1f-9275-4e7f-916b-37342fd3e86c","name":"Code1"},{"parameters":{"operation":"pdf","binaryPropertyName":"data0","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-688,640],"id":"d39b50cc-ba88-4559-b22e-bef6b34ef451","name":"Extract from File"},{"parameters":{"httpMethod":"POST","path":"141a29f6-00d4-4c60-95f5-e2b924b873dc","responseMode":"responseNode","options":{"binaryPropertyName":"data"}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-912,640],"id":"17aefd4e-1ef7-4f38-84a4-c3d0a850a48b","name":"Webhook","webhookId":"141a29f6-00d4-4c60-95f5-e2b924b873dc"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.output || \"I ran into some issues with the file you uploaded(Just for your information, file should have less than 700 pages)\" }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[464,640],"id":"81cfa09a-aced-46f2-b309-e6e610194ffb","name":"Respond to Webhook1"},{"parameters":{"workflowId":{"__rl":true,"value":"tqrgduXe2fkW7UrJ","mode":"list","cachedResultName":"Danger Detector"},"workflowInputs":{"mappingMode":"defineBelow","value":{"list":"={{ $json }}","report":"={{ $('Extract from File').item.json.text }}"},"matchingColumns":[],"schema":[{"id":"list","displayName":"list","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true},{"id":"report","displayName":"report","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-912,968],"id":"6b173895-c166-458b-a7ac-7b42f90cb11e","name":"Execute Workflow","disabled":true},{"parameters":{"jsCode":"// Get the output string\nconst outputStr = $input.first().json.output;\n\n// Parse the JSON string into an array\nconst domains = JSON.parse(outputStr);\n\n// Now you can process each domain as an object!\nreturn domains;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-688,968],"id":"75ca36e5-4494-4a1d-9bb9-fbc861ddd1b3","name":"Code2","disabled":true},{"parameters":{"workflowId":{"__rl":true,"value":"m09qUo4o1a7QMG1C","mode":"list","cachedResultName":"5-EPA Rule Book"},"workflowInputs":{"mappingMode":"defineBelow","value":{"list":"={{ $json }}","report":"={{ $('Extract from File').item.json.text }}"},"matchingColumns":[],"schema":[{"id":"list","displayName":"list","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true},{"id":"report","displayName":"report","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-464,968],"id":"ac54e446-1bc1-45c0-8913-96dbd91fadb7","name":"Execute Workflow1","disabled":true},{"parameters":{"promptType":"define","text":"={{ $json }}","options":{"systemMessage":"=You are a helpful assistant\nYou will receive an output make a professional user message on the base of it.\nLike this are the domains we got from report and their other details.\nIf you dont find any inputs plase say \"I am facing some issues with the document you uploaded.\nDo not use any placeholders such as [Recipient], [Your Name], or [Your Position/Company].\n\nInput Format (JSON array, one object per domain):\n\n[\n  {\n    \"name\": \"Domain 1\",\n    \"volume\": \"200 m³\",\n    \"material_type\": \"soil with minor debris\",\n    \"exemption\": null,\n    \"non_exemption_reason\": \"Contains debris; fails VENM/ENM criteria\"\n  },\n  .......\n]\n\nStructure of object per domain:\nname\nvolume\nmaterial_type\nexemption (\"VENM\", \"ENM\", or null)\nnon_exemption_reason (null if not applicable; otherwise, a brief reason why exemption was not assigned)\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[112,640],"id":"9ba86f77-53ce-424f-9e6f-a1b04dd54436","name":"AI Agent3"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[184,864],"id":"44e9b052-df49-4fb4-b81f-a840aaa3598c","name":"OpenAI Chat Model3","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"promptType":"define","text":"=Report:: {{ $json.text }}","options":{"systemMessage":"=You are an environmental waste organizer for NSW, Australia.\n\nYour Task:\nFor every domain, stockpile, or area described in the waste report:\n\nExtract:\nname\nvolume\nmaterial_type\nexemption (\"VENM\", \"ENM\", or null)\nnon_exemption_reason (null if not applicable; otherwise, a brief reason why exemption was not assigned)\n\nDo not assign an EPA waste class or destination.\nIf a domain cannot be extracted with the info provided, set its value to null and specify what is missing.\n\nVENM and ENM Definitions (per NSW EPA & ENM Order):\n\nVENM (Virgin Excavated Natural Material):\nUncontaminated natural material (clay, sand, gravel, soil, or rock fines) from areas not contaminated by industrial, commercial, mining, or agricultural activities.\nDoes not contain sulfidic ores or soils, or any other waste.\nHas not been processed or mixed with any other waste material.\n\nENM (Excavated Natural Material):\nOnly naturally occurring rock and soil (e.g., sandstone, shale, clay, soil) excavated from the ground.\nContains at least 98% by weight natural material.\nDoes not contain any acid sulfate soil, sulfidic ores/soils, or other waste.\nIs not contaminated by chemicals from industrial, commercial, mining, or agricultural activities.\n\nSampling and analysis must be done according to the following requirements for ENM (ENM Order Table 1):\nVolume of material (m³), Minimum number of samples required\n<100, 3\n100–200, 4\n201–500, 6\n501–1000, 8\n>1000, 1 per 250 m³ (round up)\nIf the number of samples reported for a domain claiming ENM is less than required above, set exemption to null and set non_exemption_reason to \"Insufficient samples for ENM Table 1\".\nAll laboratory results must be below the maximum allowable concentrations in Table 4 of the ENM Order.\nIf any sample result exceeds the absolute maximum in Table 4 (for any chemical), the stockpile cannot be ENM.\nThere must be a documented sampling plan, laboratory results, and a compliance certificate as required by the ENM Order.\nENM Order Table 4 — Maximum Allowable Concentrations (mg/kg) [CSV]:\n\nAnalyte,Maximum,Absolute Maximum\nAntimony,20,40\nArsenic,20,40\nBarium,500,1000\nBeryllium,2,4\nCadmium,1,2\nChromium (total),100,200\nCobalt,60,120\nCopper,60,120\nLead,60,120\nManganese,500,1000\nMercury,1,2\nMolybdenum,4,8\nNickel,20,40\nSelenium,1,2\nSilver,2,4\nThallium,2,4\nVanadium,100,200\nZinc,200,400\nBenzo(a)pyrene,0.3,0.6\nTotal PAHs,5,10\nPCBs,0.3,0.6\nTotal DDT,0.5,1\nTotal HCH,0.5,1\nChlordane,0.5,1\nHeptachlor,0.1,0.2\nAldrin/Dieldrin,0.05,0.1\nEndrin,0.05,0.1\n\nHow to use these definitions and Table 4:\nIf the waste report explicitly states \"VENM\" or \"ENM\" and the domain description, sampling, and laboratory results meet all criteria above, set exemption to \"VENM\" or \"ENM\".\nFor ENM, compare every analyte result to Table 4 above. If any value is above the “Absolute Maximum” column, set exemption to null and specify which analyte/why in non_exemption_reason.\nIf not all criteria are met (e.g., missing sampling plan, missing lab data, <98% natural, any “hotspot” over absolute max, missing compliance certificate, etc.), set exemption to null and explain reason in non_exemption_reason.\n\nOutput Format (JSON array, one object per domain):\n\n[\n  {\n    \"name\": \"Stockpile 7 (SP-7)\",\n    \"volume\": \"200 m³\",\n    \"material_type\": \"soil with minor debris\",\n    \"exemption\": null,\n    \"non_exemption_reason\": \"Contains debris; fails VENM/ENM criteria\"\n  },\n  {\n    \"name\": \"North Pad\",\n    \"volume\": \"300 m³\",\n    \"material_type\": \"natural sandy clay, uncontaminated\",\n    \"exemption\": \"VENM\",\n    \"non_exemption_reason\": null\n  },\n  {\n    \"name\": \"ENM Area A\",\n    \"volume\": \"120 m³\",\n    \"material_type\": \"excavated natural soil and shale\",\n    \"exemption\": null,\n    \"non_exemption_reason\": \"Lead exceeds absolute maximum in Table 4\"\n  }\n]\n\nUse null for any missing value or if no reason is needed.\n\nNo commentary, no summary—just the JSON array.\n\nInstructions:\nExtract only the requested fields for each domain/stockpile.\nDo not guess, group, or classify beyond what is explicitly described in the waste report.\nUse the definitions and the Table 4 above to set exemption only when all criteria are clearly met, documented, and lab results are below the absolute maximums.\nIf exemption is not possible, briefly explain in non_exemption_reason (e.g., “exceeds lead maximum,” “sampling plan missing,” “less than 98% natural material,” “asbestos detected”).\n\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-688,104],"id":"619a1a12-3ed3-46a4-b16a-caad905ba8d3","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-616,328],"id":"38cf5d02-5036-43ed-9657-e81f52f64a1d","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"jsCode":"// Get the output string\nconst outputStr = $input.first().json.output;\n\n// Parse the JSON string into an array\nconst domains = JSON.parse(outputStr);\n\n// Now you can process each domain as an object!\nreturn domains;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-336,208],"id":"f0db56ee-cf35-4287-bfbb-f6e7941e8294","name":"Code"}],"connections":{"When Executed by Another Workflow":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Code1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Code1":{"main":[[{"node":"AI Agent3","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Execute Workflow":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Execute Workflow1","type":"main","index":0}]]},"Execute Workflow1":{"main":[[]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"AI Agent3","type":"ai_languageModel","index":0}]]},"AI Agent3":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Code","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"91869a81-4a72-4126-a923-c9d6d3e9feb5","triggerCount":1,"tags":[]}