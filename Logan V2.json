{"createdAt":"2025-08-04T09:13:31.079Z","updatedAt":"2025-08-07T11:39:37.028Z","id":"QBAY3lJRkebdOVnR","name":"Logan V2","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"89be668f-2e4f-4571-99fb-1c0cc1392919","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-1072,-1180],"id":"e00a5f8e-f87d-4afd-9487-854717a2de5f","name":"Webhook","webhookId":"89be668f-2e4f-4571-99fb-1c0cc1392919"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f214dc62-4330-4054-ac30-5c56f5ec78e3","leftValue":"={{ $json.body.callback_query.id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-848,-1180],"id":"35104838-8597-49a9-a4ee-649fc75447ce","name":"Is inline button"},{"parameters":{"operation":"upsert","base":{"__rl":true,"value":"apptwzu0VB7K2LVx5","mode":"list","cachedResultName":"Logan V2","cachedResultUrl":"https://airtable.com/apptwzu0VB7K2LVx5"},"table":{"__rl":true,"value":"tbl8SdTgYKs6PGKV0","mode":"list","cachedResultName":"Session State","cachedResultUrl":"https://airtable.com/appjfd7iGxbyV0sb2/tbl8SdTgYKs6PGKV0"},"columns":{"mappingMode":"defineBelow","value":{"Session ID":"={{ $json.body.callback_query.message.chat.id.toString() }}","State":"={{ $json.body.callback_query.data }}"},"matchingColumns":["Session ID"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","readOnly":true,"removed":true},{"id":"Session ID","displayName":"Session ID","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"State","displayName":"State","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[-624,-1424],"id":"9dcb24d2-19b4-4a6e-b88d-2e461c15824c","name":"Set state","credentials":{"airtableTokenApi":{"id":"bDVfyeKNIcs0NKE7","name":"Gluagents Airtable"}}},{"parameters":{"chatId":"={{ $('Webhook').item.json.body.callback_query.message.chat.id.toString() }}","text":"=Please provide the item details:\n\n- name (required)\n- quantity\n- vendor\n- description\n- location\n\nLocation can be entered as row-rack-shelf-position, for example A12B or A-1-2-B (both mean Row A, Rack 1, Shelf 2, Position B).\n\nAvailable rows: Staging (default), A, B, C, D\nAvailable positions: A, B, C, D, E, F, G\n","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"Back to main menu","additionalFields":{"callback_data":"reset"}}]}}]},"additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-176,-1520],"id":"9659f118-23a6-4c72-9346-0059c2f6fc6f","name":"Add item response","webhookId":"fe45c5b0-7855-4d47-82b5-b5783074d67d","credentials":{"telegramApi":{"id":"3bl0ZiRunXRoY612","name":"Logan V2 Telegram"}}},{"parameters":{"operation":"search","base":{"__rl":true,"value":"apptwzu0VB7K2LVx5","mode":"list","cachedResultName":"Logan V2","cachedResultUrl":"https://airtable.com/apptwzu0VB7K2LVx5"},"table":{"__rl":true,"value":"tbl8SdTgYKs6PGKV0","mode":"list","cachedResultName":"Session State","cachedResultUrl":"https://airtable.com/apptwzu0VB7K2LVx5/tbl8SdTgYKs6PGKV0"},"filterByFormula":"={Session Id} = {{ $('Webhook').item.json.body.message.chat.id.toString() }}","returnAll":false,"limit":1,"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[-624,-936],"id":"afb283f2-5589-4183-8da6-15972ee0c94a","name":"Fetch state","alwaysOutputData":true,"credentials":{"airtableTokenApi":{"id":"bDVfyeKNIcs0NKE7","name":"Gluagents Airtable"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"61480736-52f4-44e2-a7e9-762652eeb1e2","leftValue":"={{ $json.State }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-400,-936],"id":"fc0b1f63-2513-41e5-b1e5-bed5c7b970cb","name":"If state exists"},{"parameters":{"operation":"deleteRecord","base":{"__rl":true,"value":"apptwzu0VB7K2LVx5","mode":"list","cachedResultName":"Logan V2","cachedResultUrl":"https://airtable.com/apptwzu0VB7K2LVx5"},"table":{"__rl":true,"value":"tbl8SdTgYKs6PGKV0","mode":"list","cachedResultName":"Session State","cachedResultUrl":"https://airtable.com/appjfd7iGxbyV0sb2/tbl8SdTgYKs6PGKV0"},"id":"={{ $json.id }}"},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[-176,-1328],"id":"cedb5ab5-db22-4f04-b2b4-cb85a033e197","name":"Reset state","credentials":{"airtableTokenApi":{"id":"bDVfyeKNIcs0NKE7","name":"Gluagents Airtable"}}},{"parameters":{"chatId":"=1122663858","text":"=You session has been reset successfully. Please select the appropriate option to proceed.","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"Add new inventory item(s)","additionalFields":{"callback_data":"add_items"}},{"text":"Update existing inventory item(s)","additionalFields":{"callback_data":"update_items"}}]}}]},"additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[168,-1328],"id":"ffe815bd-ac9e-476a-9874-9070dfe83afe","name":"Post reset","webhookId":"6b15184c-8ebc-41a6-8205-42564fabd15e","credentials":{"telegramApi":{"id":"3bl0ZiRunXRoY612","name":"Logan V2 Telegram"}}},{"parameters":{"chatId":"=1122663858","text":"=Hi {{ $('Webhook').item.json.body.message.chat.first_name }}, please select the appropriate option to proceed.","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"Add new inventory item(s)","additionalFields":{"callback_data":"add_items"}},{"text":"Update existing inventory item(s)","additionalFields":{"callback_data":"update_items"}}]}}]},"additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-176,-840],"id":"726c456e-0b93-423b-97a7-d2abcbd9da67","name":"Initiate","webhookId":"6b15184c-8ebc-41a6-8205-42564fabd15e","credentials":{"telegramApi":{"id":"3bl0ZiRunXRoY612","name":"Logan V2 Telegram"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('If state exists').item.json.State }}","rightValue":"add_items","operator":{"type":"string","operation":"equals"},"id":"bd98ee7a-ebde-4c9d-a9b4-cc5793aadf8d"}],"combinator":"and"},"renameOutput":true,"outputKey":"add_items"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-176,-1032],"id":"e729c1c7-e7cb-42e7-a1b7-959ac8759183","name":"State based processing"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.fields.State }}","rightValue":"add_items","operator":{"type":"string","operation":"equals"},"id":"41156a2c-f49b-49aa-ba51-ca1a34eafc74"}],"combinator":"and"},"renameOutput":true,"outputKey":"add_items"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"541cffca-a713-4b2b-b0b9-6ad0789205bc","leftValue":"={{ $json.fields.State }}","rightValue":"reset","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"reset"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-400,-1424],"id":"1a427cf2-61d1-4551-adaf-fe3ad83f4d2b","name":"State based response"},{"parameters":{"promptType":"define","text":"={{ $('Webhook').item.json.body.message.text }}","options":{"systemMessage":"=The user is currently adding an item to the inventory. If their response is unrelated, kindly prompt them to provide the necessary item details.\n\nOnly name of the item is compulsory.\n\nLocations can be referenced using a 4-part code in the format row-rack-shelf-position. For example, \"A25C\" represents Row A, Rack 2, Shelf 5, and Position C.\n\nMaintain a friendly, clear, and supportive tone. Avoid mentioning any technical or internal details.\n\nFirst name of the user: {{ $('Webhook').item.json.body.message.chat.first_name }}\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[104,-1032],"id":"1b3896ba-732f-494a-a090-ac0fd6fcfcdb","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[48,-808],"id":"d403624c-d7b9-4493-9d47-4e38cb023543","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"hpvxzuW3W9YmuUCO","name":"OpenAi account"}}},{"parameters":{"endpointUrl":"https://sleepsleeves.com/sse","include":"selected","includeTools":["add_item"]},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1.1,"position":[304,-808],"id":"0f5ca548-2986-420f-92a9-b96b589a7572","name":"MCP Client"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Webhook').item.json.body.message.chat.id }}","tableName":"logan_v2_chat_histories"},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[176,-808],"id":"343f2090-0480-4759-81a3-149a337be4a5","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"wO8bHC1OHkCa7Wux","name":"Gluagents Supabase"}}}],"connections":{"Webhook":{"main":[[{"node":"Is inline button","type":"main","index":0}]]},"Is inline button":{"main":[[{"node":"Set state","type":"main","index":0}],[{"node":"Fetch state","type":"main","index":0}]]},"Set state":{"main":[[{"node":"State based response","type":"main","index":0}]]},"Fetch state":{"main":[[{"node":"If state exists","type":"main","index":0}]]},"If state exists":{"main":[[{"node":"State based processing","type":"main","index":0}],[{"node":"Initiate","type":"main","index":0}]]},"Reset state":{"main":[[{"node":"Post reset","type":"main","index":0}]]},"State based response":{"main":[[{"node":"Add item response","type":"main","index":0}],[{"node":"Reset state","type":"main","index":0}]]},"State based processing":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"MCP Client":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"e1fd47f8-766a-495c-9188-b5bd8ae8a1d9","triggerCount":1,"tags":[{"createdAt":"2025-06-30T11:35:53.792Z","updatedAt":"2025-06-30T11:35:53.792Z","id":"wWEKn0VtZYLErCuU","name":"ashish"}]}