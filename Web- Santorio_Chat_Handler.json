{"createdAt":"2025-07-10T09:49:10.535Z","updatedAt":"2025-07-16T08:05:12.335Z","id":"17uZ2sdJbeb2bjwV","name":"Web- Santorio_Chat_Handler","active":false,"isArchived":true,"nodes":[{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Telegram Trigger').item.json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true},"id":"4fa469c8-a6a7-4c96-b976-d1659ee3821c"}],"combinator":"and"},"renameOutput":true,"outputKey":"={{ $json.message.chat }}"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"cc16c2c4-c800-48c3-8d4d-880eca6f741e","leftValue":"={{ $json.message.photo.length }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"renameOutput":true,"outputKey":"={{ $json.message.photo }}"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"43426d5f-f47a-471a-88cb-2c672d788de9","leftValue":"={{ $json.message.document.mime_type }}","rightValue":"image/jpeg","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"c4e27f09-8555-40a8-aaea-f20c1336d1b0","leftValue":"={{ $json.message.document.mime_type }}","rightValue":"image/png","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0d3030a1-e37d-4ecd-bdba-558234d6ae80","leftValue":"={{ $json.message.document.mime_type }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-740,40],"id":"47f30b1b-03d2-4239-a928-2a2ad2093110","name":"master router switch"},{"parameters":{"name":"daily_morning_update_tool","description":"=Call this tool to answer the quries if user requests a general daily health updates for themself or greets with ‚ÄúGood Morning.‚Äù,\"Update\".\"Give me my health update\"\n ","workflowId":{"__rl":true,"value":"3ppZDQEZk5L7FbCh","mode":"list","cachedResultName":"Santorio_Daily_Greeting"},"fields":{"values":[{"name":"userQuery","stringValue":"={{ $('Telegram Trigger').first().json.message.text }}"},{"name":"chatID","stringValue":"={{ $('Telegram Trigger').first().json.message.chat.id }}"}]}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.3,"position":[60,-320],"id":"0a9c1463-101a-41a0-8f4f-6b6ad82fcf64","name":"daily_morning_update_tool"},{"parameters":{"name":"single_oura_query_handler_tool","description":"=Use this tool to answer user queires if user ask for his personal health data related to sleep, activity, heart rate, and readiness score on a particular day  \n\nyou may get this information\n- **Sleep-related** ‚Üí `deep_sleep`, `efficiency`, `latency`, `rem_sleep`, `restfulness`, `timing`, `total_sleep`, `day`, `score`.  \n- **Recovery & Readiness** ‚Üí `activity_balance`, `body_temperature`, `hrv_balance`, `previous_day_activity`, `previous_night`, `recovery_index`, `resting_heart_rate`, `sleep_balance`, `temperature_deviation`, `temperature_trend_deviation`.  \n- **Activity & Workouts** ‚Üí `class_5_min`, `score`, `active_calories`, `average_met_minutes`, `meet_daily_targets`, `move_every_hour`, `recovery_time`, `stay_active`, `training_frequency`, `training_volume`, `steps`, `target_calories`, `total_calories`, `sedentary_time`, `non_wear_time`.  \n\n","workflowId":{"__rl":true,"value":"sFQxVO7qtziAmN1c","mode":"list","cachedResultName":"Santorio_Oura_Query_Handler"},"fields":{"values":[{"name":"userQuery","stringValue":"={{ $('Telegram Trigger').first().json.message.text }}"},{"name":"chatID","stringValue":"={{ $('Telegram Trigger').first().json.message.chat.id }}"}]}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.3,"position":[300,-320],"id":"c1d20d33-3a25-4aa2-9ea0-f3a189211eb3","name":"single_oura_query_handler_tool"},{"parameters":{"name":"trends_analyzer_tool","description":"=Call this tool to answer the user queries if user asks for health data over a period of time or if the user asks for trends or patterns in their health data over a period user might ask about sleep trends, readiness score changes, activity trends. \n\nfew shot examples:\n- Show me my sleep trends over the last month.\"`  \n- `\"How has my readiness score changed in the past two weeks?\"`  \n- `\"Compare my activity levels from January and February.\"`","workflowId":{"__rl":true,"value":"umrlK3xVZsVvHKJr","mode":"list","cachedResultName":"Santorio_Oura_Health_Trends"},"fields":{"values":[{"name":"userQuery","stringValue":"={{ $('Telegram Trigger').first().json.message.text }}"},{"name":"chatID","stringValue":"={{ $('Telegram Trigger').first().json.message.chat.id }}"}]}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.3,"position":[520,-320],"id":"7501651d-657d-4450-8921-1eaba92280fe","name":"trends_analyzer_tool"},{"parameters":{"model":"gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1340,200],"id":"2efcd300-8a36-48e5-abb5-b0eb6f40b731","name":"OpenAI Chat Model4","credentials":{"openAiApi":{"id":"hpvxzuW3W9YmuUCO","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.content }}\n\nActual health report details:  {{ $('Extract data from pdf').item.json.text }}\nDo not include that line This message was sent automatically with n8n\nin reposnse\n\nü©∏ AI health Report Analyzer ‚Äì Response Guidelines ü©∏\nüîπ Keep It Simple & Friendly ‚Äì Use easy-to-understand language, avoiding technical jargon.\n   Keep The response short and redable , no need of long message\nüîπ No Raw Text/JSON ‚Äì Format responses in a human-friendly way.\nüîπ Include Key Data ‚Äì Show blood test values, reference ranges, risks, and next steps.\nüîπ Use Emojis & Formatting ‚Äì ‚úÖ Normal, ‚ö†Ô∏è Slightly High/Low, üö® Critical.\nüîπ Show Patient Details ‚Äì üÜî Name, üéÇ Age, ‚öß Gender, üè• Lab Name, üìÖ Test Date.\nüîπ Clear Structure ‚Äì Use bullet points, highlight findings, and organize neatly.\nüîπ Health Tips ‚Äì Suggest diet, exercise, and medical advice if results are abnormal.\nüîπ Validate Report ‚Äì If the uploaded data isn't a related to health-related information such as lab test results, blood reports, or medical prescriptions respond with:\n‚ÄúThis is not a valid blood test report.‚Äù\n\ninstructions-- follow properly \n1.Before the final response, first check if the test is a blood test or not.\n   If it is a blood test, use the line \"your blood test results\".\n   If it's not a blood test, use the line \"your health report\" instead.\n\n2.Once you receive the final output from the tools, always append the following message to the response:\n \"Do you want to learn more? click here https://santoriov1.vercel.app/status\" \n\n3. remove all markdown symbols like ** , ## and related to that , output should be simple stucture\n"},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[1320,520],"id":"4f69fb2f-4b89-4801-8a6e-ca2b6ddad019","name":"Pdf analysis agent"},{"parameters":{"resource":"file","fileId":"={{ $json.message.document.file_id }}"},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-140,500],"id":"ef52840e-0933-4232-a53b-bc61ff5b29f3","name":"get pdf file","webhookId":"b6227907-8fea-4446-bda1-1c972c304996","credentials":{"telegramApi":{"id":"n9uqHVVmsUH0LY6C","name":"Santorio-API-Token"}}},{"parameters":{"operation":"pdf","options":{"joinPages":true,"keepSource":"both"}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[300,500],"id":"96cc88bb-ea71-4db7-91bd-01418f321e1f","name":"Extract data from pdf"},{"parameters":{"operation":"get","documentURL":"https://docs.google.com/document/d/1gXA_exZWSHlDZ0nLXqyp5psGpX_YTGC44HhUVmX8Xx0/edit?tab=t.0"},"type":"n8n-nodes-base.googleDocs","typeVersion":2,"position":[700,500],"id":"315d2ce1-46d4-4f6f-9cb6-7a3312ff72c0","name":"report analysis prompt doc","credentials":{"googleDocsOAuth2Api":{"id":"Om41V3tJihrnzpYR","name":"Google Docs account"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"GPT-4O"},"text":"=Analyse the blood report provided to you carefullly and extract all information data value\n","inputType":"base64","options":{"detail":"auto"}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.7,"position":[320,80],"id":"35f6e82a-d6e6-4cce-a9cf-f1dfeaeac79b","name":"Analysis Report Image node","credentials":{"openAiApi":{"id":"hpvxzuW3W9YmuUCO","name":"OpenAi account"}}},{"parameters":{"jsCode":"// Access the binary data\nconst binaryData = items[0].binary.data;\n\n// Set the correct MIME type\nbinaryData.mimeType = 'image/jpeg'; // or 'image/png', depending on your file\n\nreturn items;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[40,80],"id":"7e295928-7d14-4660-8200-c026bd394426","name":"convert MIME type"},{"parameters":{"resource":"file","fileId":"={{ $('Telegram Trigger').item.json.message.photo[2].file_id }}"},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-180,20],"id":"d229aceb-d588-4b19-8110-4b36b1fc0dc4","name":"get report image jpeg/jpg","webhookId":"fe42e022-bd68-4592-b179-d61f69bddfed","credentials":{"telegramApi":{"id":"n9uqHVVmsUH0LY6C","name":"Santorio-API-Token"}}},{"parameters":{"resource":"file","fileId":"={{ $json.message.document.file_id }}"},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-180,180],"id":"180d941a-67fe-4d07-b070-656fab37deb2","name":"get report image png/doc","webhookId":"53c1b0c2-80e8-4510-900f-b19f320fae64","credentials":{"telegramApi":{"id":"n9uqHVVmsUH0LY6C","name":"Santorio-API-Token"}}},{"parameters":{"model":"gpt-4.1","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1340,680],"id":"0b12ebf2-73e7-41cc-bdbb-655b9df883c7","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"hpvxzuW3W9YmuUCO","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $('Telegram Trigger').first().json.message.text }}","options":{"systemMessage":"=You are an intelligent health assistant.Your job is to understand the user‚Äôs message and reply using available tools or previous chat history.\n\n### Inputs:\n\n* User Message: {{ $('Telegram Trigger').first().json.message.text }}\n* Chat History: \" \" \n\nif user message if greeting like \"hi\",\"hellow\" or command like \"\"/start\"\n use tool **Greetings_Tool** for manage greetings only\n\n### Instructions:\n\n1. **Check chat history first** for relevant answers (e.g. scores, results).\n2. If not found, call the **right tool** ‚Äî but only **once per query**.\n3. Always use the **general_conversational_query** tool to answer general queries ( health advices, Genral Medicle terminolgy , Dieses advices ).\n3. Use **disease_causes_recommendations** for:\n   * Diseases, causes, risks\n4. Use **health_reports_assiatnce_tool** for:\n   * Blood reports, CBC, sodium, thyroid, lipid profile, or health report counts\n5. Use **user_personal_health_details** to get user health profile/info.\n6. Use **Get_last_execution_cost** if the user asks about last execution cost or tokens.\n7. Use **get_last_execution_quality_summary** for quality summary of last run.\n\n9. If no valid info in chat history, **always call tools**.\n10. Remove all markdown (like \\*\\* or ##) from the output.\n11. Do not hallucinate anything. Use only the information available. Do not use any other source.\n","returnIntermediateSteps":false}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1000,-580],"id":"62b1acf8-bf18-460b-99ce-ecff8ec06d24","name":"Santorio Super Agent","onError":"continueErrorOutput"},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $json.text }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1900,80],"id":"26f1f84e-c89d-42b6-8886-d1b5795ae2c9","name":"blood_reports_image _response","webhookId":"e413b79d-fbaa-4905-aa91-5793c3833a43","credentials":{"telegramApi":{"id":"n9uqHVVmsUH0LY6C","name":"Santorio-API-Token"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $json.text }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1900,520],"id":"058302cf-21a6-4ca6-a42c-5541fca0e6d6","name":"pdf_reports_response_node","webhookId":"4aa9f19a-78bf-49fa-ac55-9ab6eee51acb","credentials":{"telegramApi":{"id":"n9uqHVVmsUH0LY6C","name":"Santorio-API-Token"}}},{"parameters":{"promptType":"define","text":"={{ $json.content }}\n\nActual health report details: {{ $('Analysis Report Image node').item.json.content }}\n\nü©∏ AI health Report Analyzer ‚Äì Response Guidelines ü©∏\nüîπ Keep It Simple & Friendly ‚Äì Use easy-to-understand language, avoiding technical jargon.\n   Keep The response short and redable , no need of long message\nüîπ No Raw Text/JSON ‚Äì Format responses in a human-friendly way.\nüîπ Include Key Data ‚Äì Show blood test values, reference ranges, risks, and next steps.\nüîπ Use Emojis & Formatting ‚Äì ‚úÖ Normal, ‚ö†Ô∏è Slightly High/Low, üö® Critical.\nüîπ Show Patient Details ‚Äì üÜî Name, üéÇ Age, ‚öß Gender, üè• Lab Name, üìÖ Test Date.\nüîπ Clear Structure ‚Äì Use bullet points, highlight findings, and organize neatly.\nüîπ Health Tips ‚Äì Suggest diet, exercise, and medical advice if results are abnormal.\nüîπ Validate Report ‚Äì If the uploaded data isn't a related to health-related information such as lab test results, blood reports, or medical prescriptions respond with:\n‚ÄúThis is not a valid blood test report.‚Äù\n\ninstructions-- follow properly \n1.Before the final response, first check if the test is a blood test or not.\n   If it is a blood test, use the line \"your blood test results\".\n   If it's not a blood test, use the line \"your health report\" instead.\n\n2.Once you receive the final output from the tools, always append the following message to the response:\n \"Do you want to learn more? click here https://santoriov1.vercel.app/status\" \n\n3. remove all markdown symbols like ** , ## and related to that , output should be simple stucture\n\n4. Final response Shoukld not to long\n"},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[1320,80],"id":"bd4c531f-ced9-44a3-a267-3f206b1ebee6","name":"blood_reports_image_tool"},{"parameters":{"options":{"summarizationMethodAndPrompts":{"values":{"combineMapPrompt":"=Write a concise summary of the following:\n\n\n\"{{ $json.result.text }}\"\n\n\n\nCONCISE SUMMARY: ","prompt":"=Write a concise summary of the following:\nalso mentions the type like blood report of user \nDO not miss any data\n\n\"{text}\"\n\n\nCONCISE SUMMARY: "}}}},"type":"@n8n/n8n-nodes-langchain.chainSummarization","typeVersion":2,"position":[2660,320],"id":"db3b5895-67e9-43dd-9dba-0546e95d1a5d","name":"Summarization Chain3","disabled":true},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[2680,460],"id":"bab36351-c34c-4f3f-b1d0-120639888ec9","name":"OpenAI Chat Model7","credentials":{"openAiApi":{"id":"hpvxzuW3W9YmuUCO","name":"OpenAi account"}}},{"parameters":{"name":"dieses_couses_recommendation_tool","description":"Call this tool when a user asks query related to the diseases risk they can potentially have and their causes and recommendations for THEMSELVES.","workflowId":{"__rl":true,"value":"NHcxfqgTghxPTxYH","mode":"list","cachedResultName":"Santorio_Health_Insights_Recommender"},"fields":{"values":[{"name":"userQuery","stringValue":"={{ $('Telegram Trigger').first().json.message.text}}"},{"name":"chatID","stringValue":"={{ $('Telegram Trigger').first().json.message.chat.id }}"}]}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.3,"position":[920,-320],"id":"b6313029-689a-48e7-a1a2-e69292791be4","name":"dieses_couses_recommendation_tool"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[2740,-320],"id":"b6515e13-b7b9-4e63-b846-d75a23914d0b","name":"OpenAI Chat Model3","credentials":{"openAiApi":{"id":"hpvxzuW3W9YmuUCO","name":"OpenAi account"}}},{"parameters":{"name":"health_reports_assiatnce_tool","description":"Use this tool when the user asks about their health or blood test reports.\nIt extracts and returns data like CBC, sodium, lipid profile, thyroid levels, etc., from stored lab results.\nExample queries: \"What is my sodium?\", \"Show my CBC report\", \"Lipid profile result\", etc.\n\nAlso call this tool when user ask aboute the uploaded health reports count data ","workflowId":{"__rl":true,"value":"asxGFD8fwFJjExga","mode":"list","cachedResultName":"Santorio_Health_Report_Parser"},"fields":{"values":[{"name":"userQuery","stringValue":"={{ $('Telegram Trigger').first().json.message.text}}"},{"name":"chatID","stringValue":"={{ $('Telegram Trigger').first().json.message.chat.id }}"}]}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.3,"position":[1100,-320],"id":"d6f4a531-143d-4f39-9994-91aaefa68351","name":"health_reports_assiatnce_tool"},{"parameters":{"name":"andrew_huberman_protocols_tool","description":"Call this tool to provide accurate, science-based responses to user queries related to Andrew Huberman's protocols","workflowId":{"__rl":true,"value":"cCygyUfQeqUyyx7n","mode":"list","cachedResultName":"POC-Andrew-huberman-protocols"},"fields":{"values":[{"name":"userQuery","stringValue":"={{ $('Telegram Trigger').first().json.message.text}}"}]}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.3,"position":[1860,-320],"id":"6149cdcc-b95d-4e12-9513-6e941e1f2efa","name":"andrew_huberman_protocols_tool","disabled":true},{"parameters":{"workflowId":{"__rl":true,"value":"tdtnfw7LZLdJBt5W","mode":"list","cachedResultName":"upload health reports"},"workflowInputs":{"mappingMode":"defineBelow","value":{"report_data":"={{ $('Pdf analysis agent').item.json.text }}","file_name":"={{ $('Telegram Trigger').item.json.message.document.file_name }}","userID":"={{ $('Telegram Trigger').item.json.message.chat.id }}","file_source":"={{ $('Extract data from pdf').item.json.result.file_path }}"},"matchingColumns":["report_data"],"schema":[{"id":"report_data","displayName":"report_data","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"file_name","displayName":"file_name","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"userID","displayName":"userID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"file_source","displayName":"file_source","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[2420,320],"id":"b889ce7a-7575-4409-8f90-3d0207fb04bb","name":"Execute Workflow"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appn6GinPIiaJLmwu","mode":"list","cachedResultName":"santorio-memory-db","cachedResultUrl":"https://airtable.com/appn6GinPIiaJLmwu"},"table":{"__rl":true,"value":"tblFSKIi3ja3Gtdpu","mode":"list","cachedResultName":"Santorio-Agent-logs","cachedResultUrl":"https://airtable.com/appn6GinPIiaJLmwu/tblFSKIi3ja3Gtdpu"},"columns":{"mappingMode":"defineBelow","value":{"Actions":"=null","Tokens":"=null","Cost":"=null","Timestamp":"={{ $now.format('yyyy-MM-dd hh:dd a') }}","workflow":"={{$workflow.name  }}","output":"=null","input":"={{ $('Telegram Trigger').item.json.message.text }}","ErrorMessage":"={{ $('Santorio Super Agent').item.json.error }}"},"matchingColumns":[],"schema":[{"id":"Timestamp","displayName":"Timestamp","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"input","displayName":"input","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"output","displayName":"output","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"workflow","displayName":"workflow","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"ErrorMessage","displayName":"ErrorMessage","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Actions","displayName":"Actions","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Tokens","displayName":"Tokens","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Cost","displayName":"Cost","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1900,-960],"id":"90c72afe-132d-4a88-b36b-2a874f676adf","name":"error_logs","credentials":{"airtableTokenApi":{"id":"LjkU3CjQ2npQkFJl","name":"Airtable Personal Access Token account"}}},{"parameters":{"name":"Get_last_execution_cost","description":"Call this tool to retrieve the cost and token usage details of the most recent AI prompt execution, including prompt and completion tokens.","workflowId":{"__rl":true,"value":"DmAEsxJmsh5QriOv","mode":"list","cachedResultName":"Get Cost of excucation"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[1300,-320],"id":"6a75b1f7-c44b-42b1-a83a-dca5c4b97233","name":"Get_last_execution_cost","disabled":true},{"parameters":{"updates":["message"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[-1220,20],"id":"d27ec903-2b3a-4f09-b6ee-4bcd8b93fa89","name":"Telegram Trigger","webhookId":"9443cb48-7f39-489a-8ac6-de855701f785","credentials":{"telegramApi":{"id":"n9uqHVVmsUH0LY6C","name":"Santorio-API-Token"}},"disabled":true},{"parameters":{"name":"get_last_execution_quality_summary","description":"Call this tool to get the last execution quality summary based on key evaluation metrics like faithfulness, relevance, correctness, summarization quality, and toxicity.","workflowId":{"__rl":true,"value":"4SR1OO432mVZbWec","mode":"list","cachedResultName":"Get Last Execution Quality"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.1,"position":[1660,-320],"id":"27c3fe8c-28fb-47ec-a108-6fbcf7b5ed00","name":"get_last_execution_quality_summary","disabled":true},{"parameters":{"content":"# Agent Trigger\n","height":400,"width":380,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1340,-60],"id":"36305b49-6547-4aba-9e22-41822aba38d0","name":"Sticky Note"},{"parameters":{"content":"# Santorio Super Agent\n \n\n**Santorio Super Agent** is a smart helper that understands what the user is asking and gives the right answer by using the right tools.\n\n* Reads and understands the user‚Äôs question carefully.\n* Picks the right tool based on the question.\n* Each tool has a clear name and description to help the agent choose quickly.\n* Sends the final answer back to the user after using the selected tool.\n\n","height":580,"width":2480,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-300,-680],"id":"f485d174-734b-4efa-8189-4ff0ecef5093","name":"Sticky Note1"},{"parameters":{"content":"# Master Router\n.\n\n","height":400,"width":500,"color":6},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-900,-60],"id":"62ab1249-1fef-4c5c-aea8-9fb6ac5c6be0","name":"Sticky Note4"},{"parameters":{"content":"# Get image/file uploaded by Telegram  - Convert MIME Type - Analysis Report Image Node\n\n ","height":400,"width":1400,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-300,-60],"id":"e45939e6-305b-4303-aa2a-fc5830a1c2f5","name":"Sticky Note5"},{"parameters":{"content":"# Response","height":380,"width":440,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1740,-60],"id":"c6556d92-b927-46e9-8560-892157916dfd","name":"Sticky Note8"},{"parameters":{"content":"# Response","height":440,"width":460,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1740,360],"id":"1cc79358-021f-40d3-b4e6-0a3a97321c92","name":"Sticky Note9"},{"parameters":{"content":"## PDF Analysis Agent\nUses AI to read and analyze uploaded PDF reports, returning insights based on their contents.\n\n","height":440,"width":540,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1160,360],"id":"1cf7d8b7-5747-4e8c-adf9-60ac58f18350","name":"Sticky Note10"},{"parameters":{"content":"# Get image/file uploaded by Telegram Extract The Information or Data -  Prompt For AI","height":440,"width":1400,"color":5},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-300,360],"id":"dba8c4d6-4ec4-48eb-b422-2a310b8a871c","name":"Sticky Note11"},{"parameters":{"workflowId":{"__rl":true,"value":"g9xW3CEEfLWjscvi","mode":"list","cachedResultName":"costing tool"},"workflowInputs":{"mappingMode":"defineBelow","value":{"workflowname":"={{$workflow.name  }}","excuationID":"={{$execution.id}}"},"matchingColumns":["execution ID"],"schema":[{"id":"intermediateSteps","displayName":"intermediateSteps","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":true},{"id":"workflowname","displayName":"workflowname","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false},{"id":"input","displayName":"input","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":true},{"id":"output","displayName":"output","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":true},{"id":"userId","displayName":"userId","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":true},{"id":"excuationID","displayName":"excuationID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{"waitForSubWorkflow":false}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[3760,-160],"id":"ed357d93-4b15-4167-8c5a-6476901daade","name":"Execute Costing Tool"},{"parameters":{"content":"# Store the user's health report data along with a summary.\n\n","height":860,"width":1260},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2240,-60],"id":"027ac2b3-8ca6-4026-a0bd-5b78530cd86b","name":"Sticky Note14"},{"parameters":{"workflowId":{"__rl":true,"value":"hLBI0B5y93BEKzuh","mode":"list","cachedResultName":"Store Quality Analysis Summary"},"workflowInputs":{"mappingMode":"defineBelow","value":{"output":"={{ $('Santorio Super Agent').item.json.output }}","input":"={{ $('Telegram Trigger').first().json.message.text }}","workflowName":"={{ $workflow.name }}","executionID":"={{ $execution.id }}"},"matchingColumns":[],"schema":[{"id":"input","displayName":"input","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true},{"id":"output","displayName":"output","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true},{"id":"workflowName","displayName":"workflowName","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":false},{"id":"executionID","displayName":"executionID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[2380,-480],"id":"ade06e58-7be2-4350-bc68-83a91e86495d","name":"Execute Quality Analysis Agent","onError":"continueRegularOutput"},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appn6GinPIiaJLmwu","mode":"list","cachedResultName":"santorio-memory-db","cachedResultUrl":"https://airtable.com/appn6GinPIiaJLmwu"},"table":{"__rl":true,"value":"tblyDq3tLtgxDmpvn","mode":"list","cachedResultName":"san-memory-table","cachedResultUrl":"https://airtable.com/appn6GinPIiaJLmwu/tblyDq3tLtgxDmpvn"},"columns":{"mappingMode":"defineBelow","value":{"chatID":"={{ $('Telegram Trigger').first().json.message.chat.id }}","chatHistory":"={{ $json.response.text }}"},"matchingColumns":[],"schema":[{"id":"chatID","displayName":"chatID","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"number","readOnly":false,"removed":false},{"id":"chatHistory","displayName":"chatHistory","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[3180,-480],"id":"759cdd21-fab9-4b18-934b-e17ec23e7328","name":"Store summary in memory db","credentials":{"airtableTokenApi":{"id":"LjkU3CjQ2npQkFJl","name":"Airtable Personal Access Token account"}}},{"parameters":{"content":"# Execute Quality Analysis Agent - Store summary in memory db","height":560,"width":1260},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[2240,-680],"id":"f3b5c391-7aa7-4b1d-b140-2731a71c2002","name":"Sticky Note17"},{"parameters":{"options":{"summarizationMethodAndPrompts":{"values":{"combineMapPrompt":"=Write a concise summary of the following:\n\n\n\"{{ $json.result.text }}\"\n\n\nCONCISE SUMMARY:"}}}},"type":"@n8n/n8n-nodes-langchain.chainSummarization","typeVersion":2,"position":[2720,-480],"id":"6f88432e-97e1-4787-a352-0e3649435a5a","name":"Summarize input/output"},{"parameters":{"content":"# Analysis Report Image Node\nUses AI to read and analyze reports, returning insights based on their contents.\n\n","height":380,"width":540,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1160,-60],"id":"928cf9c7-4d79-455d-90c5-60234da85cfa","name":"Sticky Note19"},{"parameters":{"workflowId":{"__rl":true,"value":"DRZU7oMYJSRPwM1R","mode":"list","cachedResultName":"SantorioV3InputsAnalysis"},"workflowInputs":{"mappingMode":"defineBelow","value":{"text":"={{ $json.response.text }}","userID":"={{ $('Telegram Trigger').item.json.message.chat.id }}","file_source":"={{ $('Extract data from pdf').item.json.result.file_path }}"},"matchingColumns":[],"schema":[{"id":"text","displayName":"text","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"},{"id":"userID","displayName":"userID","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"number"},{"id":"file_source","displayName":"file_source","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":true,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[3060,320],"id":"f8c5ffbd-338f-40d5-8d4b-369448fbb91a","name":"ExecutExecute Input Analysis For PDFe Input Analysis","disabled":true},{"parameters":{"content":"## Store Error Logs\n","height":320,"width":380},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1780,-1060],"id":"a9dc9902-ec73-4469-bbef-bcd871aa3ec9","name":"Sticky Note22"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-240,-300],"id":"33e2abf4-4429-40d0-aecb-78bd360243f5","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"L5UoHZfkBt6nb3Ad","name":"OpenAi Account"}}},{"parameters":{"description":"Call this tool get diabetes-and-toxins related informations","workflowId":{"__rl":true,"value":"He6MI2TjfhAr6HcD","mode":"list","cachedResultName":"Santorio_Diabetes_Toxins_Analyzer"},"workflowInputs":{"mappingMode":"defineBelow","value":{"userQuery":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('userQuery', `add user query inside that `, 'string') }}"},"matchingColumns":["userQuery"],"schema":[{"id":"userQuery","displayName":"userQuery","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1480,-320],"id":"a20c12bf-be48-4255-87f5-eb4060e7ddd2","name":"diabetes-and-toxins","disabled":true},{"parameters":{"operation":"get","documentURL":"https://docs.google.com/document/d/1gXA_exZWSHlDZ0nLXqyp5psGpX_YTGC44HhUVmX8Xx0/edit?tab=t.0"},"type":"n8n-nodes-base.googleDocs","typeVersion":2,"position":[700,80],"id":"bf3654a5-8e68-4d60-a554-337f8c2180ba","name":"report analysis prompt doc1","credentials":{"googleDocsOAuth2Api":{"id":"Om41V3tJihrnzpYR","name":"Google Docs account"}}},{"parameters":{"content":"# Cost Analysis\n","height":500,"width":600},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3540,-360],"id":"655533b8-234f-4cfe-9c27-4acc6240585d","name":"Sticky Note23"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"=Hey Kevin! üëã I‚Äôm Santorio, your personal health coach üßë‚Äç‚öïÔ∏è\nPowered by your Oura Ring insights üíç, I help you understand your sleep üò¥, activity üèÉ, and readiness üí° data.\nYou can also upload your health reports üìÑ (like blood tests), and I‚Äôll provide personalized insights üîç and easy-to-understand explanations üß† based on your results.","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegramTool","typeVersion":1.2,"position":[2020,-320],"id":"e8c6c5e7-5b1c-4883-9e30-b3a0c55336a4","name":"Greetings_Tool","webhookId":"fde4629b-9128-4239-bdc6-cd93530c57c0","credentials":{"telegramApi":{"id":"n9uqHVVmsUH0LY6C","name":"Santorio-API-Token"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolThink","typeVersion":1,"position":[-120,-300],"id":"b5b5ac85-df61-45ef-91d4-026b2daa04b7","name":"Think"},{"parameters":{"name":"conversational_tool","description":"Call this tool to answer the user queries if the user **engages in casual conversation** or asks **general health-related questions** (not about their own health).","workflowId":{"__rl":true,"value":"Sv88injvBKy3kbsp","mode":"list","cachedResultName":"encyclopedia"},"fields":{"values":[{"name":"userQuery","stringValue":"={{ $('Telegram Trigger').first().json.message.text }}"},{"name":"chatID","stringValue":"={{ $('Telegram Trigger').first().json.message.chat.id }}"}]}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.3,"position":[720,-320],"id":"c2f0f322-1715-41c6-8fa9-bf3582be3c62","name":"Dr. Joe Brain"},{"parameters":{},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1220,200],"id":"5abc095b-4f89-462b-a31b-ea659610a244","name":"When Executed by Another Workflow"}],"connections":{"master router switch":{"main":[[{"node":"Santorio Super Agent","type":"main","index":0}],[{"node":"get report image jpeg/jpg","type":"main","index":0}],[{"node":"get report image png/doc","type":"main","index":0}],[{"node":"get report image png/doc","type":"main","index":0}],[{"node":"get pdf file","type":"main","index":0}]]},"daily_morning_update_tool":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"single_oura_query_handler_tool":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"trends_analyzer_tool":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"blood_reports_image_tool","type":"ai_languageModel","index":0}]]},"Pdf analysis agent":{"main":[[{"node":"pdf_reports_response_node","type":"main","index":0}]]},"get pdf file":{"main":[[{"node":"Extract data from pdf","type":"main","index":0}]]},"Extract data from pdf":{"main":[[{"node":"report analysis prompt doc","type":"main","index":0}]]},"report analysis prompt doc":{"main":[[{"node":"Pdf analysis agent","type":"main","index":0}]]},"Analysis Report Image node":{"main":[[{"node":"report analysis prompt doc1","type":"main","index":0}]]},"convert MIME type":{"main":[[{"node":"Analysis Report Image node","type":"main","index":0}]]},"get report image jpeg/jpg":{"main":[[{"node":"convert MIME type","type":"main","index":0}]]},"get report image png/doc":{"main":[[{"node":"convert MIME type","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Pdf analysis agent","type":"ai_languageModel","index":0}]]},"Santorio Super Agent":{"main":[[{"node":"Execute Quality Analysis Agent","type":"main","index":0}],[{"node":"error_logs","type":"main","index":0}]]},"blood_reports_image_tool":{"main":[[{"node":"blood_reports_image _response","type":"main","index":0}]]},"blood_reports_image _response":{"main":[[{"node":"Execute Workflow","type":"main","index":0}]]},"pdf_reports_response_node":{"main":[[{"node":"Execute Workflow","type":"main","index":0}]]},"OpenAI Chat Model7":{"ai_languageModel":[[{"node":"Summarization Chain3","type":"ai_languageModel","index":0}]]},"Summarization Chain3":{"main":[[{"node":"ExecutExecute Input Analysis For PDFe Input Analysis","type":"main","index":0}]]},"dieses_couses_recommendation_tool":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"Summarize input/output","type":"ai_languageModel","index":0}]]},"health_reports_assiatnce_tool":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"andrew_huberman_protocols_tool":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"Execute Workflow":{"main":[[{"node":"Summarization Chain3","type":"main","index":0}]]},"Get_last_execution_cost":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"Telegram Trigger":{"main":[[{"node":"master router switch","type":"main","index":0}]]},"get_last_execution_quality_summary":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"Execute Costing Tool":{"main":[[]]},"Execute Quality Analysis Agent":{"main":[[{"node":"Summarize input/output","type":"main","index":0}]]},"Store summary in memory db":{"main":[[{"node":"Execute Costing Tool","type":"main","index":0}]]},"Summarize input/output":{"main":[[{"node":"Store summary in memory db","type":"main","index":0}]]},"ExecutExecute Input Analysis For PDFe Input Analysis":{"main":[[{"node":"Execute Costing Tool","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Santorio Super Agent","type":"ai_languageModel","index":0}]]},"diabetes-and-toxins":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"report analysis prompt doc1":{"main":[[{"node":"blood_reports_image_tool","type":"main","index":0}]]},"Greetings_Tool":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"Think":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"Dr. Joe Brain":{"ai_tool":[[{"node":"Santorio Super Agent","type":"ai_tool","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"master router switch","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"single_oura_query_handler_tool":[{"json":{"isArtificialRecoveredEventItem":true}}],"Telegram Trigger":[{"json":{"update_id":927068811,"message":{"message_id":3285,"from":{"id":1480386325,"is_bot":false,"first_name":"rahul","last_name":"choudhary","language_code":"en"},"chat":{"id":1480386325,"first_name":"rahul","last_name":"choudhary","type":"private"},"date":1751442739,"text":"What is the HIV how we can prevent that"}}}]},"versionId":"2b20ce6e-1cca-4e7e-91ef-551aeeb9d6ad","triggerCount":1,"tags":[{"createdAt":"2025-04-11T09:22:08.439Z","updatedAt":"2025-04-11T09:22:08.439Z","id":"njm6GTgmZ72M7rfN","name":"San 3.0 - Main"},{"createdAt":"2025-04-11T09:22:08.440Z","updatedAt":"2025-04-11T09:22:08.440Z","id":"cvzQAF8NRsTc2q4S","name":"Santorio"},{"createdAt":"2025-07-10T09:29:28.648Z","updatedAt":"2025-07-10T09:29:28.648Z","id":"fSH0WoDYCyb46CsN","name":"web"}]}