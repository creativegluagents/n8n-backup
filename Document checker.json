{"createdAt":"2025-07-28T10:34:31.089Z","updatedAt":"2025-08-11T11:46:30.773Z","id":"YSGCDKWlU7ZSKMaF","name":"Document checker","active":true,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"={{ $('When Executed by Another Workflow').first().json.text || $('Extract from File1').first().json.text }}","options":{"systemMessage":"=Today's date: {{ $today }}\n\nYou are a compliance assistant for waste classification. Given only the raw text of a waste classification report, extract and report the following:\n\n1. Report Date\n- Find the main report date (issue date, revision date, or signature date).\n- If the date is more than 2 years ago, label it as \"TOO OLD\". Otherwise, label as \"VALID\".\n\n2. Mandatory Sections\nFor each required section, check if it is present anywhere in the text (including appendices or attachments). Accept close matches:\n- Chain of Custody\n- Certificate Analysis (also accept \"Laboratory Results\", \"Certificates of Analysis\", \"Lab Reports\")\n- Site History (also accept \"Introduction\" or \"Background\" or \"Site Description\" if describing site/project history)\n\nFor each, return:\n- Whether it is Found or Not Found\n- The actual section heading and page/location (if mentioned)\n- If not found, say \"Not Found\"\n\n3. Extract if present:\n- Waste volumes (with units, e.g., tons, m3)\n- Waste areas (with units, e.g., ha, m2)\n- Consultant name\n- All found dates (report date, sampling dates, etc.)\n\n4. Output Format\nReturn everything in this template:\n\n# Document Compliance Check\n\n## Report Date\n{date} ({status})\n\n## Mandatory Sections\n- Chain of Custody: {Found/Not Found} ({section heading/location or \"Not Found\"})\n- Certificate Analysis: {Found/Not Found} ({section heading/location or \"Not Found\"})\n- Site History: {Found/Not Found} ({section heading/location or \"Not Found\"})\n\n## Key Information\n- Waste Volumes: {text or \"Not Found\"}\n- Waste Areas: {text or \"Not Found\"}\n- Consultant Name: {text or \"Not Found\"}\n- All Dates Found: {comma-separated list or \"Not Found\"}\n\nInstructions:\n- Do not summarize or comment.\n- Do not make up content—only report what is present.\n- If a heading is similar but not exact, return the actual heading."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-6112,-2488],"id":"9017ea6e-dcbc-4b7d-b208-e94266058986","name":"AI Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-6040,-2264],"id":"7c7666f4-2aa3-4ead-ad34-fdb2dc1be04d","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-5312,-3364],"id":"f395c480-bbc7-467a-864d-64cea33af2a7","name":"Extract from File1"},{"parameters":{"jsCode":"// Get markdown from the previous node (change the key if yours is different)\nconst md = $input.first().json.output || \"\";\n\n// Helper to extract values using regex\nfunction extract(regex, input) {\n  const match = input.match(regex);\n  return match ? match[1].trim() : null;\n}\n\n// Extract report date and status\nconst dateMatch = md.match(/## Report Date\\s*([\\s\\S]+?)\\((VALID|TOO OLD)\\)/i);\nconst reportDate = dateMatch ? dateMatch[1].trim() : null;\nconst reportStatus = dateMatch ? dateMatch[2].trim() : null;\n\n// Extract mandatory sections (Chain of Custody, Certificate Analysis, Site History)\nconst chainMatch = md.match(/Chain of Custody:\\s*(Found|Not Found)[^(]*\\(([^)]*)\\)/i);\nconst chainStatus = chainMatch ? chainMatch[1].trim() : null;\nconst chainDetails = chainMatch ? chainMatch[2].trim() : null;\n\nconst certMatch = md.match(/Certificate Analysis:\\s*(Found|Not Found)[^(]*\\(([^)]*)\\)/i);\nconst certStatus = certMatch ? certMatch[1].trim() : null;\nconst certDetails = certMatch ? certMatch[2].trim() : null;\n\nconst siteMatch = md.match(/Site History:\\s*(Found|Not Found)[^(]*\\(([^)]*)\\)/i);\nconst siteStatus = siteMatch ? siteMatch[1].trim() : null;\nconst siteDetails = siteMatch ? siteMatch[2].trim() : null;\n\n// Optional: Waste Volumes, Areas, Consultant Name\nconst wasteVolume = extract(/Waste Volumes:\\s*([^\\n]+)/i, md);\nconst wasteAreas = extract(/Waste Areas:\\s*([^\\n]+)/i, md);\nconst consultant = extract(/Consultant Name:\\s*([^\\n]+)/i, md);\n\n// Output JSON for easy use in IF nodes or next steps\nreturn [\n  {\n    reportDate,\n    reportStatus,\n    chainStatus,\n    chainDetails,\n    certStatus,\n    certDetails,\n    siteStatus,\n    siteDetails,\n    wasteVolume,\n    wasteAreas,\n    consultant\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5760,-2488],"id":"eefd65c8-b97c-4684-8695-ed3dbc5ca97e","name":"Code"},{"parameters":{"conditions":{"options":{"caseSensitive":false,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"abb2d357-3694-4200-9667-eefd17de2dc7","leftValue":"={{ $json.reportStatus }}","rightValue":"TOO OLD","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"abd287d8-3bf3-43fb-a3fd-f84790a18f2d","leftValue":"={{ $json.chainStatus }}","rightValue":"Not found","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"32e13b5e-4ffd-4342-b377-32c02e4bfed7","leftValue":"={{ $json.certStatus }}","rightValue":"Not found","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"05bae99f-086e-4e64-b231-14caaaddfe62","leftValue":"={{ $json.siteStatus }}","rightValue":"Not found","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{"ignoreCase":true}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5536,-2488],"id":"07b582d0-602e-4fe3-aa64-8ef6fe619338","name":"If"},{"parameters":{"sendTo":"shreyansh@gammastack.com","subject":" Request for Updated Report and Missing Information","message":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-4960,-2636],"id":"c162b9b9-9742-4224-8246-ba21b50ac70d","name":"Send a message","webhookId":"ce3dc8da-9235-4f21-90bd-82ff1b020745","credentials":{"gmailOAuth2":{"id":"g60VLt9jxOFvg1X1","name":"Gluagents Gmail"}}},{"parameters":{"workflowInputs":{"values":[{"name":"text"},{"name":"chatId"}]}},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-6112,-368],"id":"f586590d-29fc-40e8-9c84-de4cf6e08ab7","name":"When Executed by Another Workflow"},{"parameters":{"assignments":{"assignments":[{"id":"1fe8ea2b-3f54-460c-8d08-8e487837a563","name":"output","value":"={{ $('AI Agent').item.json.output }}","type":"string"},{"id":"8cbd7893-bde1-47c0-9c2d-9e6975d25f68","name":"Completed","value":false,"type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4736,-2636],"id":"ec8e77a8-c7db-498e-bb6b-b4e35e1c2918","name":"Edit Fields"},{"parameters":{"assignments":{"assignments":[{"id":"7b89829c-bf0c-4664-85ea-b5bb0ea19b50","name":"output","value":"={{ $('AI Agent').item.json.output }}","type":"string"},{"id":"4d4c897e-0ddf-4cdf-a46e-d196f72450de","name":"Completed","value":true,"type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5248,-2340],"id":"0fa6c707-6283-4087-8487-932cf117cc03","name":"Edit Fields1"},{"parameters":{"promptType":"define","text":"=waste classification document compliance check summary:: {{ $('AI Agent').item.json.output }}","options":{"systemMessage":"=You are a compliance assistant.\n\nYou will receive a waste classification document compliance check summary.\nDraft a clear and professional email to the report submitter if the report is too old and/or if any required section is missing.\n\nInstructions:\n\nBegin with a polite greeting such as “Hello,”.\n\nIf the report is marked as “TOO OLD,” clearly mention that the report cannot be accepted due to its age.\n\nIf any mandatory section is marked “Not Found,” list only those missing sections in a clear bullet list.\n\nDo not mention any sections that are marked as “Found”.\n\nAsk the recipient to provide an updated and complete report including all required information as soon as possible.\n\nUse a professional, concise, and helpful tone.\n\nClose with a polite thank you and “Best regards”.\n\nDo not reference AI, automation, or personal names.\n\nInput:\nYou will receive a summary like this:\n\n# Document Compliance Check\n\n## Report Date\n10 February 2019 (TOO OLD)\n\n## Mandatory Sections\n- Chain of Custody: Not Found (Not Present)\n- Certificate Analysis: Found (Appendix C)\n- Site History: Not Found (Not Present)\nYour output should be an email like this:\nHello,\n\nThank you for your recent submission of the waste classification report.\n\nUpon review, we have identified the following issues:\n\nThe report provided is more than two years old and cannot be accepted.\n\nThe following required section(s) are missing:\n\nChain of Custody\n\nSite History\n\nPlease provide an updated report with all required sections and current information at your earliest convenience.\n\nThank you for your attention to this matter.\n\nBest regards\n\nUse only the information from the compliance summary.\nNever mention sections that are marked as “Found”.\nDo not include names, sign-offs, or any information not in the template above."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-5312,-2740],"id":"d67696d7-bd68-4212-8924-8c60f1baaafd","name":"AI Agent1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-5240,-2516],"id":"4a719b6e-5ecd-40b1-a9c8-d1b8cce0619f","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"updates":["message"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[-6112,-3216],"id":"c59974c2-c1c5-418e-9c09-fcfb39b3d156","name":"Telegram Trigger","webhookId":"bf697917-2376-492c-9d80-6f567bfe63d2","credentials":{"telegramApi":{"id":"I2PMmz1t790ehVom","name":"Document Checker Bot"}}},{"parameters":{"resource":"file","fileId":"={{ $('Telegram Trigger').item.json.message.document.file_id }}","additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-5600,-3364],"id":"d1fba5ce-e91a-407d-9b32-f3780009160e","name":"get pdf file","webhookId":"be551ee1-f9dc-450e-88b1-c39577414b80","credentials":{"telegramApi":{"id":"I2PMmz1t790ehVom","name":"Document Checker Bot"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0d3030a1-e37d-4ecd-bdba-558234d6ae80","leftValue":"={{ $json.message.document.mime_type }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true},"id":"4fa469c8-a6a7-4c96-b976-d1659ee3821c"}],"combinator":"and"},"renameOutput":true,"outputKey":"={{ $json.message.text }}"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-5888,-3216],"id":"bb24ee75-34da-4570-a562-f0faa79e25f7","name":"master router switch"},{"parameters":{"promptType":"define","text":"={{ $json.message.text }}","options":{"systemMessage":"You are a helpful assistant\nGreet user and tell him to upload a waste report."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-5664,-3068],"id":"529d7db8-2e9a-4430-92e3-0cb71a9ff0db","name":"AI Agent2"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-5592,-2844],"id":"ea793f12-f992-416c-9ca1-f6c42f660dad","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $json.output }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-5312,-3068],"id":"c995e124-78db-4181-bc68-18490369828f","name":"pdf_reports_response_node2","webhookId":"03191d51-43e9-4b10-875e-9c2ba6c37363","credentials":{"telegramApi":{"id":"I2PMmz1t790ehVom","name":"Document Checker Bot"}}},{"parameters":{"promptType":"define","text":"={{ $json.text }}","options":{"systemMessage":"=Today's date: {{ $today }}\n\nYou are a compliance assistant for waste classification. Given only the raw text of a waste classification report, extract and report the following:\n\n1. Report Date\n- Find the main report date (issue date, revision date, or signature date).\n- If the date is more than 2 years ago, label it as \"TOO OLD\". Otherwise, label as \"VALID\".\n\n2. Mandatory Sections\nFor each required section, check if it is present anywhere in the text (including appendices or attachments). Accept close matches:\n- Chain of Custody\n- Certificate Analysis (also accept \"Laboratory Results\", \"Certificates of Analysis\", \"Lab Reports\")\n- Site History (also accept \"Introduction\" or \"Background\" or \"Site Description\" if describing site/project history)\n\nFor each, return:\n- Whether it is Found or Not Found\n- The actual section heading and page/location (if mentioned)\n- If not found, say \"Not Found\"\n\n3. Extract if present:\n- Waste volumes (with units, e.g., tons, m3)\n- Waste areas (with units, e.g., ha, m2)\n- Consultant name\n- All found dates (report date, sampling dates, etc.)\n\n4. Output Format\nReturn everything in this template:\n\n# Document Compliance Check\n\n## Report Date\n{date} ({status})\n\n## Mandatory Sections\n- Chain of Custody: {Found/Not Found} ({section heading/location or \"Not Found\"})\n- Certificate Analysis: {Found/Not Found} ({section heading/location or \"Not Found\"})\n- Site History: {Found/Not Found} ({section heading/location or \"Not Found\"})\n\n## Key Information\n- Waste Volumes: {text or \"Not Found\"}\n- Waste Areas: {text or \"Not Found\"}\n- Consultant Name: {text or \"Not Found\"}\n- All Dates Found: {comma-separated list or \"Not Found\"}\n\nInstructions:\n- Do not summarize or comment.\n- Do not make up content—only report what is present.\n- If a heading is similar but not exact, return the actual heading."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-5088,-3364],"id":"d7114466-41e1-4eda-a904-e89847b7bc95","name":"AI Agent3"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-5016,-3140],"id":"1b44fcdd-d18f-41b4-95c3-4960ddd614ad","name":"OpenAI Chat Model3","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"jsCode":"// Get markdown from the previous node (change the key if yours is different)\nconst md = $input.first().json.output || \"\";\n\n// Helper to extract values using regex\nfunction extract(regex, input) {\n  const match = input.match(regex);\n  return match ? match[1].trim() : null;\n}\n\n// Extract report date and status\nconst dateMatch = md.match(/## Report Date\\s*([\\s\\S]+?)\\((VALID|TOO OLD)\\)/i);\nconst reportDate = dateMatch ? dateMatch[1].trim() : null;\nconst reportStatus = dateMatch ? dateMatch[2].trim() : null;\n\n// Extract mandatory sections (Chain of Custody, Certificate Analysis, Site History)\nconst chainMatch = md.match(/Chain of Custody:\\s*(Found|Not Found)[^(]*\\(([^)]*)\\)/i);\nconst chainStatus = chainMatch ? chainMatch[1].trim() : null;\nconst chainDetails = chainMatch ? chainMatch[2].trim() : null;\n\nconst certMatch = md.match(/Certificate Analysis:\\s*(Found|Not Found)[^(]*\\(([^)]*)\\)/i);\nconst certStatus = certMatch ? certMatch[1].trim() : null;\nconst certDetails = certMatch ? certMatch[2].trim() : null;\n\nconst siteMatch = md.match(/Site History:\\s*(Found|Not Found)[^(]*\\(([^)]*)\\)/i);\nconst siteStatus = siteMatch ? siteMatch[1].trim() : null;\nconst siteDetails = siteMatch ? siteMatch[2].trim() : null;\n\n// Optional: Waste Volumes, Areas, Consultant Name\nconst wasteVolume = extract(/Waste Volumes:\\s*([^\\n]+)/i, md);\nconst wasteAreas = extract(/Waste Areas:\\s*([^\\n]+)/i, md);\nconst consultant = extract(/Consultant Name:\\s*([^\\n]+)/i, md);\n\n// Output JSON for easy use in IF nodes or next steps\nreturn [\n  {\n    reportDate,\n    reportStatus,\n    chainStatus,\n    chainDetails,\n    certStatus,\n    certDetails,\n    siteStatus,\n    siteDetails,\n    wasteVolume,\n    wasteAreas,\n    consultant\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4736,-3364],"id":"b95bb027-4b45-4b4a-b2e5-7b2121785648","name":"Code1"},{"parameters":{"conditions":{"options":{"caseSensitive":false,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"abb2d357-3694-4200-9667-eefd17de2dc7","leftValue":"={{ $json.reportStatus }}","rightValue":"TOO OLD","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"abd287d8-3bf3-43fb-a3fd-f84790a18f2d","leftValue":"={{ $json.chainStatus }}","rightValue":"Not found","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"32e13b5e-4ffd-4342-b377-32c02e4bfed7","leftValue":"={{ $json.certStatus }}","rightValue":"Not found","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"05bae99f-086e-4e64-b231-14caaaddfe62","leftValue":"={{ $json.siteStatus }}","rightValue":"Not found","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{"ignoreCase":true}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-4512,-3364],"id":"f488df93-0598-43a5-8d94-93710b6ca0fa","name":"If4"},{"parameters":{"sendTo":"shreyansh@gammastack.com","subject":" Request for Updated Report and Missing Information","message":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-3936,-3512],"id":"a0988ebc-2ef4-4277-8623-b433e5b48766","name":"Send a message1","webhookId":"ce3dc8da-9235-4f21-90bd-82ff1b020745","credentials":{"gmailOAuth2":{"id":"g60VLt9jxOFvg1X1","name":"Gluagents Gmail"}}},{"parameters":{"promptType":"define","text":"=waste classification document compliance check summary:: {{ $('AI Agent3').item.json.output }}","options":{"systemMessage":"=You are a compliance assistant.\n\nYou will receive a waste classification document compliance check summary.\nDraft a clear and professional email to the report submitter if the report is too old and/or if any required section is missing.\n\nInstructions:\n\nBegin with a polite greeting such as “Hello,”.\n\nIf the report is marked as “TOO OLD,” clearly mention that the report cannot be accepted due to its age.\n\nIf any mandatory section is marked “Not Found,” list only those missing sections in a clear bullet list.\n\nDo not mention any sections that are marked as “Found”.\n\nAsk the recipient to provide an updated and complete report including all required information as soon as possible.\n\nUse a professional, concise, and helpful tone.\n\nClose with a polite thank you and “Best regards”.\n\nDo not reference AI, automation, or personal names.\n\nInput:\nYou will receive a summary like this:\n\n# Document Compliance Check\n\n## Report Date\n10 February 2019 (TOO OLD)\n\n## Mandatory Sections\n- Chain of Custody: Not Found (Not Present)\n- Certificate Analysis: Found (Appendix C)\n- Site History: Not Found (Not Present)\nYour output should be an email like this:\nHello,\n\nThank you for your recent submission of the waste classification report.\n\nUpon review, we have identified the following issues:\n\nThe report provided is more than two years old and cannot be accepted.\n\nThe following required section(s) are missing:\n\nChain of Custody\n\nSite History\n\nPlease provide an updated report with all required sections and current information at your earliest convenience.\n\nThank you for your attention to this matter.\n\nBest regards\n\nUse only the information from the compliance summary.\nNever mention sections that are marked as “Found”.\nDo not include names, sign-offs, or any information not in the template above."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-4288,-3616],"id":"9cc1f921-facb-4885-8871-497b9dda28cc","name":"AI Agent4"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-4216,-3392],"id":"f1e33f68-3c01-457a-a53f-317d37a2b0f7","name":"OpenAI Chat Model4","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $('AI Agent3').item.json.output }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-3712,-3512],"id":"382cab71-e71e-405b-aa1e-2f9b8901e390","name":"pdf_reports_response_node3","webhookId":"03191d51-43e9-4b10-875e-9c2ba6c37363","credentials":{"telegramApi":{"id":"I2PMmz1t790ehVom","name":"Document Checker Bot"}}},{"parameters":{"chatId":"={{ $('Telegram Trigger').first().json.message.chat.id }}","text":"={{ $('AI Agent3').item.json.output }}","additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-4224,-3216],"id":"dc25fedd-cc41-476a-8639-7851d8b3c134","name":"pdf_reports_response_node4","webhookId":"03191d51-43e9-4b10-875e-9c2ba6c37363","credentials":{"telegramApi":{"id":"I2PMmz1t790ehVom","name":"Document Checker Bot"}}},{"parameters":{"promptType":"define","text":"={{ $json.text }}","options":{"systemMessage":"=Today's date: {{ $today }}\n\nYou are a compliance assistant for waste classification. Given only the raw text of a waste classification report, extract and report the following:\n\n1. Report Date\n- Find the main report date (issue date, revision date, or signature date).\n- If the date is more than 2 years ago, label it as \"TOO OLD\". Otherwise, label as \"VALID\".\n\n2. Mandatory Sections\nFor each required section, check if it is present anywhere in the text (including appendices or attachments). Accept close matches:\n- Chain of Custody\n- Certificate Analysis (also accept \"Laboratory Results\", \"Certificates of Analysis\", \"Lab Reports\")\n- Site History (also accept \"Introduction\" or \"Background\" or \"Site Description\" if describing site/project history)\n\nFor each, return:\n- Whether it is Found or Not Found\n- The actual section heading and page/location (if mentioned)\n- If not found, say \"Not Found\"\n\n3. Extract if present:\n- Waste volumes (with units, e.g., tons, m3)\n- Waste areas (with units, e.g., ha, m2)\n- Consultant name\n- All found dates (report date, sampling dates, etc.)\n\n4. Output Format\nReturn everything in this template:\n\n# Document Compliance Check\n\n## Report Date\n{date} ({status})\n\n## Mandatory Sections\n- Chain of Custody: {Found/Not Found} ({section heading/location or \"Not Found\"})\n- Certificate Analysis: {Found/Not Found} ({section heading/location or \"Not Found\"})\n- Site History: {Found/Not Found} ({section heading/location or \"Not Found\"})\n\n## Key Information\n- Waste Volumes: {text or \"Not Found\"}\n- Waste Areas: {text or \"Not Found\"}\n- Consultant Name: {text or \"Not Found\"}\n- All Dates Found: {comma-separated list or \"Not Found\"}\n\nInstructions:\n- Do not summarize or comment.\n- Do not make up content—only report what is present.\n- If a heading is similar but not exact, return the actual heading."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-5664,-1864],"id":"e50c3a16-a55e-4587-bd48-71485cf705d8","name":"AI Agent5","onError":"continueRegularOutput"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-5592,-1640],"id":"232c637b-af0e-4938-93aa-e2606d312759","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"jsCode":"// Get markdown from the previous node (change the key if yours is different)\nconst md = $input.first().json.output || \"\";\n\n// Helper to extract values using regex\nfunction extract(regex, input) {\n  const match = input.match(regex);\n  return match ? match[1].trim() : null;\n}\n\n// Extract report date and status\nconst dateMatch = md.match(/## Report Date\\s*([\\s\\S]+?)\\((VALID|TOO OLD)\\)/i);\nconst reportDate = dateMatch ? dateMatch[1].trim() : null;\nconst reportStatus = dateMatch ? dateMatch[2].trim() : null;\n\n// Extract mandatory sections (Chain of Custody, Certificate Analysis, Site History)\nconst chainMatch = md.match(/Chain of Custody:\\s*(Found|Not Found)[^(]*\\(([^)]*)\\)/i);\nconst chainStatus = chainMatch ? chainMatch[1].trim() : null;\nconst chainDetails = chainMatch ? chainMatch[2].trim() : null;\n\nconst certMatch = md.match(/Certificate Analysis:\\s*(Found|Not Found)[^(]*\\(([^)]*)\\)/i);\nconst certStatus = certMatch ? certMatch[1].trim() : null;\nconst certDetails = certMatch ? certMatch[2].trim() : null;\n\nconst siteMatch = md.match(/Site History:\\s*(Found|Not Found)[^(]*\\(([^)]*)\\)/i);\nconst siteStatus = siteMatch ? siteMatch[1].trim() : null;\nconst siteDetails = siteMatch ? siteMatch[2].trim() : null;\n\n// Optional: Waste Volumes, Areas, Consultant Name\nconst wasteVolume = extract(/Waste Volumes:\\s*([^\\n]+)/i, md);\nconst wasteAreas = extract(/Waste Areas:\\s*([^\\n]+)/i, md);\nconst consultant = extract(/Consultant Name:\\s*([^\\n]+)/i, md);\n\n// Output JSON for easy use in IF nodes or next steps\nreturn [\n  {\n    reportDate,\n    reportStatus,\n    chainStatus,\n    chainDetails,\n    certStatus,\n    certDetails,\n    siteStatus,\n    siteDetails,\n    wasteVolume,\n    wasteAreas,\n    consultant\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5312,-1864],"id":"d9c4eda0-1972-48e7-b43e-aaf889f3e43e","name":"Code2"},{"parameters":{"conditions":{"options":{"caseSensitive":false,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"abb2d357-3694-4200-9667-eefd17de2dc7","leftValue":"={{ $json.reportStatus }}","rightValue":"TOO OLD","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"abd287d8-3bf3-43fb-a3fd-f84790a18f2d","leftValue":"={{ $json.chainStatus }}","rightValue":"Not found","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"32e13b5e-4ffd-4342-b377-32c02e4bfed7","leftValue":"={{ $json.certStatus }}","rightValue":"Not found","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"05bae99f-086e-4e64-b231-14caaaddfe62","leftValue":"={{ $json.siteStatus }}","rightValue":"Not found","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"or"},"options":{"ignoreCase":true}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5088,-1864],"id":"a3e45fae-3a13-4571-9b92-26f6f1c05354","name":"If1"},{"parameters":{"sendTo":"shreyansh@gammastack.com","subject":" Request for Updated Report and Missing Information","message":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-4512,-2012],"id":"89d8c77d-a04a-43b2-88e9-57b0df681b98","name":"Send a message2","webhookId":"ce3dc8da-9235-4f21-90bd-82ff1b020745","credentials":{"gmailOAuth2":{"id":"g60VLt9jxOFvg1X1","name":"Gluagents Gmail"}}},{"parameters":{"assignments":{"assignments":[{"id":"1fe8ea2b-3f54-460c-8d08-8e487837a563","name":"output","value":"={{ $('AI Agent5').item.json.output }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4288,-2012],"id":"7446e173-f58b-4fc9-86d4-8014ef9512e1","name":"Edit Fields2"},{"parameters":{"assignments":{"assignments":[{"id":"7b89829c-bf0c-4664-85ea-b5bb0ea19b50","name":"output","value":"={{ $('AI Agent5').item.json.output }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4800,-1716],"id":"af3aa31f-121d-4958-bdeb-77ca955fa3be","name":"Edit Fields3"},{"parameters":{"promptType":"define","text":"=waste classification document compliance check summary:: {{ $('AI Agent5').item.json.output }}","options":{"systemMessage":"=You are a compliance assistant.\n\nYou will receive a waste classification document compliance check summary.\nDraft a clear and professional email to the report submitter if the report is too old and/or if any required section is missing.\n\nInstructions:\n\nBegin with a polite greeting such as “Hello,”.\n\nIf the report is marked as “TOO OLD,” clearly mention that the report cannot be accepted due to its age.\n\nIf any mandatory section is marked “Not Found,” list only those missing sections in a clear bullet list.\n\nDo not mention any sections that are marked as “Found”.\n\nAsk the recipient to provide an updated and complete report including all required information as soon as possible.\n\nUse a professional, concise, and helpful tone.\n\nClose with a polite thank you and “Best regards”.\n\nDo not reference AI, automation, or personal names.\n\nInput:\nYou will receive a summary like this:\n\n# Document Compliance Check\n\n## Report Date\n10 February 2019 (TOO OLD)\n\n## Mandatory Sections\n- Chain of Custody: Not Found (Not Present)\n- Certificate Analysis: Found (Appendix C)\n- Site History: Not Found (Not Present)\nYour output should be an email like this:\nHello,\n\nThank you for your recent submission of the waste classification report.\n\nUpon review, we have identified the following issues:\n\nThe report provided is more than two years old and cannot be accepted.\n\nThe following required section(s) are missing:\n\nChain of Custody\n\nSite History\n\nPlease provide an updated report with all required sections and current information at your earliest convenience.\n\nThank you for your attention to this matter.\n\nBest regards\n\nUse only the information from the compliance summary.\nNever mention sections that are marked as “Found”.\nDo not include names, sign-offs, or any information not in the template above."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-4864,-2116],"id":"a1287e24-924a-4978-ab0a-a8061d153c02","name":"AI Agent6"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-4792,-1892],"id":"474fa32d-d4b8-4013-b13f-b9fc51adff54","name":"OpenAI Chat Model6","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"httpMethod":"POST","path":"e91d733a-4fe5-41cf-a024-9b2ec3a6f914","responseMode":"responseNode","options":{"binaryPropertyName":"data"}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6112,-1864],"id":"28545a48-68ae-4e2a-bbfb-fb2061f2b11a","name":"File Webhook","webhookId":"e91d733a-4fe5-41cf-a024-9b2ec3a6f914","disabled":true},{"parameters":{"operation":"pdf","binaryPropertyName":"data0","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-5888,-1864],"id":"170f949c-f894-4d19-9d47-f39a336fe7fb","name":"Extract from File"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[-4064,-2012],"id":"bc95134b-a54e-44f8-8698-36a42f1218b3","name":"Respond to Webhook"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.output || \"I ran into some issues with the file you uploaded(Just for your information, file should have less than 700 pages)\" }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[-4512,-1716],"id":"e3051296-4476-408d-9f68-b2ff6384cd57","name":"Respond to Webhook1"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-5592,-972],"id":"6c23f19f-6694-43fb-8d2d-55a67ec97a7e","name":"OpenAI Chat Model7","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"conditions":{"options":{"caseSensitive":false,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"abb2d357-3694-4200-9667-eefd17de2dc7","leftValue":"={{ $json.report_date.status }}","rightValue":"TOO OLD","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"abd287d8-3bf3-43fb-a3fd-f84790a18f2d","leftValue":"={{ $json.mandatory_sections.chain_of_custody.found }}","rightValue":"false","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"32e13b5e-4ffd-4342-b377-32c02e4bfed7","leftValue":"={{ $json.mandatory_sections.certificate_analysis.found }}","rightValue":"Not found","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"05bae99f-086e-4e64-b231-14caaaddfe62","leftValue":"={{ $json.mandatory_sections.site_history.found }}","rightValue":"Not found","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"9bad2c7d-cced-4559-85d0-6111b7cf32b6","leftValue":"={{ $json.error }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"or"},"options":{"ignoreCase":true}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5088,-1196],"id":"79e2b85d-8177-4662-a4b9-25a5dce84782","name":"If2"},{"parameters":{"sendTo":"shreyansh@gammastack.com","subject":" Request for Updated Report and Missing Information","message":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-4160,-1196],"id":"f012ad21-6377-4954-be1f-ac1f97e00fb8","name":"Send a message3","webhookId":"ce3dc8da-9235-4f21-90bd-82ff1b020745","credentials":{"gmailOAuth2":{"id":"g60VLt9jxOFvg1X1","name":"Gluagents Gmail"}}},{"parameters":{"assignments":{"assignments":[{"id":"1fe8ea2b-3f54-460c-8d08-8e487837a563","name":"output","value":"={{ $('V2').item.json.output }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-3936,-1196],"id":"e800974d-ad8a-4605-9818-9a16b9f8d5a6","name":"Edit Fields4"},{"parameters":{"promptType":"define","text":"=waste classification document compliance check summary:: {{ $('V2').item.json.output }}","options":{"systemMessage":"=You are a compliance assistant.\n\nYou will receive a waste classification document compliance check summary.\nDraft a clear and professional email to the report submitter if the report is too old and/or if any required section is missing.\n\nInstructions:\n\nBegin with a polite greeting such as “Hello,”.\n\nIf the report is marked as “TOO OLD,” clearly mention that the report cannot be accepted due to its age.\n\nIf any mandatory section is marked “Not Found,” list only those missing sections in a clear bullet list.\n\nDo not mention any sections that are marked as “Found”.\n\nAsk the recipient to provide an updated and complete report including all required information as soon as possible.\n\nUse a professional, concise, and helpful tone.\n\nClose with a polite thank you and “Best regards”.\n\nDo not reference AI, automation, or personal names.\n\nInput:\nYou will receive a summary like this:\n\n# Document Compliance Check\n\n## Report Date\n10 February 2019 (TOO OLD)\n\n## Mandatory Sections\n- Chain of Custody: Not Found (Not Present)\n- Certificate Analysis: Found (Appendix C)\n- Site History: Not Found (Not Present)\nYour output should be an email like this:\nHello,\n\nThank you for your recent submission of the waste classification report.\n\nUpon review, we have identified the following issues:\n\nThe report provided is more than two years old and cannot be accepted.\n\nThe following required section(s) are missing:\n\nChain of Custody\n\nSite History\n\nPlease provide an updated report with all required sections and current information at your earliest convenience.\n\nThank you for your attention to this matter.\n\nBest regards\n\nUse only the information from the compliance summary.\nNever mention sections that are marked as “Found”.\nDo not include names, sign-offs, or any information not in the template above."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-4512,-1300],"id":"cefc3a19-5eb8-46e6-9bf7-ee45ac438df3","name":"AI Agent8"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-4440,-1076],"id":"e9692dd9-a993-43ce-ab05-f04ab8c89789","name":"OpenAI Chat Model8","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"httpMethod":"POST","path":"e91d733a-4fe5-41cf-a024-9b2ec3a6f914","responseMode":"responseNode","options":{"binaryPropertyName":"data"}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6112,-1196],"id":"b92d13ff-2acc-4ac8-87b0-2bf3040c70f2","name":"File Webhook1","webhookId":"e91d733a-4fe5-41cf-a024-9b2ec3a6f914"},{"parameters":{"operation":"pdf","binaryPropertyName":"data0","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-5888,-1196],"id":"c008d3aa-9977-4255-8f05-2be2333ef0b5","name":"Extract from File2"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[-3712,-1196],"id":"73e68893-4731-4fa7-b450-a23a78d31958","name":"Respond to Webhook2"},{"parameters":{"respondWith":"text","responseBody":"={{ $json.output || \"I ran into some issues with the file you uploaded(Just for your information, file should have less than 700 pages)\" }}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[-4448,-900],"id":"96186dd8-9a7e-42ce-9be7-7bd9c26a07e8","name":"Respond to Webhook3"},{"parameters":{"promptType":"define","text":"={{ $json.text }}","options":{"systemMessage":"=You are a compliance assistant for waste classification.\nGiven only the raw text of a waste classification report, extract and output the following as JSON without any additional commentary or formatting.\n\nExtraction Requirements\n1. Report Date\n\nIdentify the main report date (issue date, revision date, or signature date).\n\nIf the date is more than 2 years old (from today’s date: {{ $today }}), set \"status\": \"TOO OLD\". Otherwise, \"status\": \"VALID\".\n\n2. Mandatory Sections\nFor each required section, check if it is present anywhere in the text (including appendices or attachments). Accept close matches:\n\n\"Chain of Custody\" → exact or close match.\n\n\"Certificate Analysis\" → accept \"Laboratory Results\", \"Certificates of Analysis\", \"Lab Reports\".\n\n\"Site History\" → accept \"Introduction\", \"Background\", \"Site Description\" if describing site/project history.\n\nFor each section, output:\n\njson\nCopy\nEdit\n{\n  \"found\": true/false,\n  \"heading_or_location\": \"exact heading text and page/location if present, otherwise 'Not Found'\"\n}\n3. Additional Data Extraction\nIf present in the text, extract:\n\nWaste volumes (with units, e.g., \"12 tons\", \"3.5 m3\").\n\nWaste areas (with units, e.g., \"2 ha\", \"150 m2\").\n\nConsultant name.\n\nAll found dates (report date, sampling dates, etc.) as an array in YYYY-MM-DD format if possible.\n\nJSON Output Format\njson\nCopy\nEdit\n{\n  \"report_date\": {\n    \"date\": \"YYYY-MM-DD\",\n    \"status\": \"VALID | TOO OLD\"\n  },\n  \"mandatory_sections\": {\n    \"chain_of_custody\": {\n      \"found\": true/false,\n      \"heading_or_location\": \"string\"\n    },\n    \"certificate_analysis\": {\n      \"found\": true/false,\n      \"heading_or_location\": \"string\"\n    },\n    \"site_history\": {\n      \"found\": true/false,\n      \"heading_or_location\": \"string\"\n    }\n  },\n  \"key_information\": {\n    \"waste_volumes\": \"string or 'Not Found'\",\n    \"waste_areas\": \"string or 'Not Found'\",\n    \"consultant_name\": \"string or 'Not Found'\",\n    \"all_dates_found\": [\"YYYY-MM-DD\", \"...\"] \n  }\n}\nRules:\n\nDo not summarize, interpret, or add commentary.\n\nDo not fabricate missing information—only extract what is present.\n\nFor partial matches, use the actual heading text from the report."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-5664,-1196],"id":"73e591bd-3d85-46ca-b6de-ad175a4ebf93","name":"V2","onError":"continueRegularOutput"},{"parameters":{"jsCode":"// Get the output string from AI agent\nconst outputStr = $input.first().json.output;\n\n// Remove markdown code block if present\nlet cleanedStr = outputStr\n  .replace(/```(?:json)?\\s*/gi, '') // Remove ```json or ```\n  .replace(/```/g, '')              // Remove closing ```\n  .replace(/\\/\\/.*$/gm, '')         // Remove JS-style comments\n  .trim();\n\n// Parse the cleaned JSON string\nconst domains = JSON.parse(cleanedStr);\n\nreturn domains;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5312,-1200],"id":"51c453a7-ad46-4c64-b889-dabf956c431a","name":"Code3","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-6112,-180],"id":"484ae466-6a19-4eb4-8aed-da450444eeee","name":"When clicking ‘Execute workflow’"},{"parameters":{"promptType":"define","text":"={{ $json.toJsonString() }}","options":{"systemMessage":"=You are a compliance summarizer for waste classification.\n\nINPUT: You will receive a single JSON object from a previous extraction step. This object follows this schema:\n{\n  \"report_date\": { \"date\": \"YYYY-MM-DD\", \"status\": \"VALID|TOO OLD\" },\n  \"mandatory_sections\": {\n    \"chain_of_custody\": { \"found\": true|false, \"heading_or_location\": \"string\" },\n    \"certificate_analysis\": { \"found\": true|false, \"heading_or_location\": \"string\" },\n    \"site_history\": { \"found\": true|false, \"heading_or_location\": \"string\" }\n  },\n  \"key_information\": {\n    \"waste_volumes\": \"string or 'Not Found'\",\n    \"waste_areas\": \"string or 'Not Found'\",\n    \"consultant_name\": \"string or 'Not Found'\",\n    \"all_dates_found\": [\"YYYY-MM-DD\", \"...\"]\n  }\n}\n\nTASK: Produce a concise, human-readable compliance summary in **Markdown**, not JSON.\nTone: factual, concise, regulatory-compliant. Do not invent facts. If something is missing, write “Not Provided”.\n\nSTRUCTURE EXACTLY:\n\n# Waste Classification – Compliance Summary\n\n## Compliance Snapshot\n- **Report date:** {date} ({status})\n- **Sections present:** {comma-separated list of sections with found=true, or “None”}\n- **Sections missing:** {comma-separated list of sections with found=false, or “None”}\n\n## Key Figures\n- **Waste volumes:** {value or Not Provided}\n- **Waste areas:** {value or Not Provided}\n- **Consultant:** {value or Not Provided}\n\nRULES:\n- Do not summarize beyond the structure above.\n- All section names in “Sections present/missing” should be exactly: “Chain of Custody”, “Certificate Analysis”, “Site History”.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-4864,-1004],"id":"d51b9c2f-175c-485f-b4b5-9bf441b1f7ba","name":"AI Agent7"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-4792,-780],"id":"f9b83584-d2a6-4278-a40e-81874450e582","name":"OpenAI Chat Model9","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b0c85d76-6957-4704-af08-2f7879a4d215","leftValue":"={{ $json.error }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-4800,-1344],"id":"0a07f08e-344e-4a9a-82e2-898ddef66370","name":"If3"},{"parameters":{"respondWith":"text","responseBody":"=\"I am facing some issues with the document you uploaded\"","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[-4448,-1492],"id":"64af32fc-447f-4e54-90fd-772b73f45a8d","name":"Respond to Webhook4"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-5816,-52],"id":"38fbd1fe-6981-4409-b598-e8b725dcc2c9","name":"OpenAI Chat Model10","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"conditions":{"options":{"caseSensitive":false,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"abb2d357-3694-4200-9667-eefd17de2dc7","leftValue":"={{ $json.report_date.status }}","rightValue":"TOO OLD","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"abd287d8-3bf3-43fb-a3fd-f84790a18f2d","leftValue":"={{ $json.mandatory_sections.chain_of_custody.found }}","rightValue":"false","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"32e13b5e-4ffd-4342-b377-32c02e4bfed7","leftValue":"={{ $json.mandatory_sections.certificate_analysis.found }}","rightValue":"Not found","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"05bae99f-086e-4e64-b231-14caaaddfe62","leftValue":"={{ $json.mandatory_sections.site_history.found }}","rightValue":"Not found","operator":{"type":"boolean","operation":"false","singleValue":true}},{"id":"9bad2c7d-cced-4559-85d0-6111b7cf32b6","leftValue":"={{ $json.error }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"or"},"options":{"ignoreCase":true}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5312,-276],"id":"77a3dedf-1d70-46be-8f74-e9befa696811","name":"If5"},{"parameters":{"sendTo":"shreyansh@gammastack.com","subject":" Request for Updated Report and Missing Information","message":"={{ $json.output }}","options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[-4384,-276],"id":"55055763-707d-4fdf-b4cc-47a400ff41bd","name":"Send a message4","webhookId":"ce3dc8da-9235-4f21-90bd-82ff1b020745","credentials":{"gmailOAuth2":{"id":"g60VLt9jxOFvg1X1","name":"Gluagents Gmail"}}},{"parameters":{"assignments":{"assignments":[{"id":"1fe8ea2b-3f54-460c-8d08-8e487837a563","name":"output","value":"={{ $('V').item.json.output }}","type":"string"},{"id":"8b56114a-f7b7-4eb5-9c61-b7cd84598056","name":"passed","value":false,"type":"boolean"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4160,-276],"id":"e9dce93f-1515-4b3b-9fc5-43e54a678200","name":"Edit Fields5"},{"parameters":{"promptType":"define","text":"=waste classification document compliance check summary:: {{ $('V').item.json.output }}","options":{"systemMessage":"=You are a compliance assistant.\n\nYou will receive a waste classification document compliance check summary.\nDraft a clear and professional email to the report submitter if the report is too old and/or if any required section is missing.\n\nInstructions:\n\nBegin with a polite greeting such as “Hello,”.\n\nIf the report is marked as “TOO OLD,” clearly mention that the report cannot be accepted due to its age.\n\nIf any mandatory section is marked “Not Found,” list only those missing sections in a clear bullet list.\n\nDo not mention any sections that are marked as “Found”.\n\nAsk the recipient to provide an updated and complete report including all required information as soon as possible.\n\nUse a professional, concise, and helpful tone.\n\nClose with a polite thank you and “Best regards”.\n\nDo not reference AI, automation, or personal names.\n\nInput:\nYou will receive a summary like this:\n\n# Document Compliance Check\n\n## Report Date\n10 February 2019 (TOO OLD)\n\n## Mandatory Sections\n- Chain of Custody: Not Found (Not Present)\n- Certificate Analysis: Found (Appendix C)\n- Site History: Not Found (Not Present)\nYour output should be an email like this:\nHello,\n\nThank you for your recent submission of the waste classification report.\n\nUpon review, we have identified the following issues:\n\nThe report provided is more than two years old and cannot be accepted.\n\nThe following required section(s) are missing:\n\nChain of Custody\n\nSite History\n\nPlease provide an updated report with all required sections and current information at your earliest convenience.\n\nThank you for your attention to this matter.\n\nBest regards\n\nUse only the information from the compliance summary.\nNever mention sections that are marked as “Found”.\nDo not include names, sign-offs, or any information not in the template above."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-4736,-380],"id":"7d7e3bf6-08d1-46cb-8bfe-d2afd28458cd","name":"AI Agent9"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-4664,-156],"id":"dd84f52a-984c-4794-bf7a-7aaca3766990","name":"OpenAI Chat Model11","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"promptType":"define","text":"={{ $json.text }}","options":{"systemMessage":"=You are a compliance assistant for waste classification.\nGiven only the raw text of a waste classification report, extract and output the following as JSON without any additional commentary or formatting.\n\nExtraction Requirements\n1. Report Date\n\nIdentify the main report date (issue date, revision date, or signature date).\n\nIf the date is more than 2 years old (from today’s date: {{ $today }}), set \"status\": \"TOO OLD\". Otherwise, \"status\": \"VALID\".\n\n2. Mandatory Sections\nFor each required section, check if it is present anywhere in the text (including appendices or attachments). Accept close matches:\n\n\"Chain of Custody\" → exact or close match.\n\n\"Certificate Analysis\" → accept \"Laboratory Results\", \"Certificates of Analysis\", \"Lab Reports\".\n\n\"Site History\" → accept \"Introduction\", \"Background\", \"Site Description\" if describing site/project history.\n\nFor each section, output:\n\n{\n  \"found\": true/false,\n  \"heading_or_location\": \"exact heading text and page/location if present, otherwise 'Not Found'\"\n}\n3. Additional Data Extraction\nIf present in the text, extract:\n\nWaste volumes (with units, e.g., \"12 tons\", \"3.5 m3\").\n\nWaste areas (with units, e.g., \"2 ha\", \"150 m2\").\n\nConsultant name.\n\nAll found dates (report date, sampling dates, etc.) as an array in YYYY-MM-DD format if possible.\n\nJSON Output Format\n{\n  \"report_date\": {\n    \"date\": \"YYYY-MM-DD\",\n    \"status\": \"VALID | TOO OLD\"\n  },\n  \"mandatory_sections\": {\n    \"chain_of_custody\": {\n      \"found\": true/false,\n      \"heading_or_location\": \"string\"\n    },\n    \"certificate_analysis\": {\n      \"found\": true/false,\n      \"heading_or_location\": \"string\"\n    },\n    \"site_history\": {\n      \"found\": true/false,\n      \"heading_or_location\": \"string\"\n    }\n  },\n  \"key_information\": {\n    \"waste_volumes\": \"string or 'Not Found'\",\n    \"waste_areas\": \"string or 'Not Found'\",\n    \"consultant_name\": \"string or 'Not Found'\",\n    \"all_dates_found\": [\"YYYY-MM-DD\", \"...\"] \n  }\n}\nRules:\n\nDo not summarize, interpret, or add commentary.\n\nDo not fabricate missing information—only extract what is present.\n\nFor partial matches, use the actual heading text from the report."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-5888,-272],"id":"11215265-072d-4274-970e-bf9daab0925b","name":"V","onError":"continueRegularOutput"},{"parameters":{"jsCode":"// Get the output string from AI agent\nconst outputStr = $input.first().json.output;\n\n// Remove markdown code block if present\nlet cleanedStr = outputStr\n  .replace(/```(?:json)?\\s*/gi, '') // Remove ```json or ```\n  .replace(/```/g, '')              // Remove closing ```\n  .replace(/\\/\\/.*$/gm, '')         // Remove JS-style comments\n  .trim();\n\n// Parse the cleaned JSON string\nconst domains = JSON.parse(cleanedStr);\n\nreturn domains;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-5536,-276],"id":"a185c789-c727-4f03-a1ec-8afa4c359044","name":"Code4","alwaysOutputData":true,"onError":"continueRegularOutput"},{"parameters":{"promptType":"define","text":"={{ $json.toJsonString() }}","options":{"systemMessage":"=You are a compliance summarizer for waste classification.\n\nINPUT: You will receive a single JSON object from a previous extraction step. This object follows this schema:\n{\n  \"report_date\": { \"date\": \"YYYY-MM-DD\", \"status\": \"VALID|TOO OLD\" },\n  \"mandatory_sections\": {\n    \"chain_of_custody\": { \"found\": true|false, \"heading_or_location\": \"string\" },\n    \"certificate_analysis\": { \"found\": true|false, \"heading_or_location\": \"string\" },\n    \"site_history\": { \"found\": true|false, \"heading_or_location\": \"string\" }\n  },\n  \"key_information\": {\n    \"waste_volumes\": \"string or 'Not Found'\",\n    \"waste_areas\": \"string or 'Not Found'\",\n    \"consultant_name\": \"string or 'Not Found'\",\n    \"all_dates_found\": [\"YYYY-MM-DD\", \"...\"]\n  }\n}\n\nTASK: Produce a concise, human-readable compliance summary in **Markdown**, not JSON.\nTone: factual, concise, regulatory-compliant. Do not invent facts. If something is missing, write “Not Provided”.\n\nSTRUCTURE EXACTLY:\n\n# Waste Classification – Compliance Summary\n\n## Compliance Snapshot\n- **Report date:** {date} ({status})\n- **Sections present:** {comma-separated list of sections with found=true, or “None”}\n- **Sections missing:** {comma-separated list of sections with found=false, or “None”}\n\n## Key Figures\n- **Waste volumes:** {value or Not Provided}\n- **Waste areas:** {value or Not Provided}\n- **Consultant:** {value or Not Provided}\n\nRULES:\n- Do not summarize beyond the structure above.\n- All section names in “Sections present/missing” should be exactly: “Chain of Custody”, “Certificate Analysis”, “Site History”.\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-5088,20],"id":"908468fe-ea6b-4074-b5d1-8a1bb4ea2594","name":"AI Agent10"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1","mode":"list","cachedResultName":"gpt-4.1"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-5016,244],"id":"f3a7c58d-5348-4028-8f38-bde79f5af7db","name":"OpenAI Chat Model12","credentials":{"openAiApi":{"id":"G5B8fc5uUqqLH94p","name":"OpenAi account 3"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b0c85d76-6957-4704-af08-2f7879a4d215","leftValue":"={{ $json.error }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-5024,-424],"id":"3702f58e-58ef-48a6-975c-39dd9590df6d","name":"If6"},{"parameters":{"assignments":{"assignments":[{"id":"1fe8ea2b-3f54-460c-8d08-8e487837a563","name":"output","value":"={{ $json.output }}","type":"string"},{"id":"8b56114a-f7b7-4eb5-9c61-b7cd84598056","name":"passed","value":true,"type":"boolean"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4672,20],"id":"7700691f-a1ec-47d1-9e41-50a0a3c4f068","name":"Edit Fields7"},{"parameters":{"assignments":{"assignments":[{"id":"fc0bae51-8ab8-44fe-8e87-ebbb97dd73a6","name":"output","value":"I have some issues with the dovcument you uploaded","type":"string"},{"id":"fa158875-87f8-4a2b-a486-6d3b101cea18","name":"passed","value":false,"type":"boolean"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-4672,-572],"id":"e5239181-e6cb-4351-afec-f2ca28b98d26","name":"Edit Fields8"}],"connections":{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Extract from File1":{"main":[[{"node":"AI Agent3","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"AI Agent1","type":"main","index":0}],[{"node":"Edit Fields1","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"V","type":"main","index":0}]]},"Send a message":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"Send a message","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Edit Fields":{"main":[[]]},"Telegram Trigger":{"main":[[{"node":"master router switch","type":"main","index":0}]]},"get pdf file":{"main":[[{"node":"Extract from File1","type":"main","index":0}]]},"master router switch":{"main":[[{"node":"get pdf file","type":"main","index":0}],[{"node":"AI Agent2","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"AI Agent2","type":"ai_languageModel","index":0}]]},"AI Agent2":{"main":[[{"node":"pdf_reports_response_node2","type":"main","index":0}]]},"AI Agent3":{"main":[[{"node":"Code1","type":"main","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"AI Agent3","type":"ai_languageModel","index":0}]]},"Code1":{"main":[[{"node":"If4","type":"main","index":0}]]},"If4":{"main":[[{"node":"AI Agent4","type":"main","index":0}],[{"node":"pdf_reports_response_node4","type":"main","index":0}]]},"Send a message1":{"main":[[{"node":"pdf_reports_response_node3","type":"main","index":0}]]},"AI Agent4":{"main":[[{"node":"Send a message1","type":"main","index":0}]]},"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"AI Agent4","type":"ai_languageModel","index":0}]]},"AI Agent5":{"main":[[{"node":"Code2","type":"main","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"AI Agent5","type":"ai_languageModel","index":0}]]},"Code2":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"AI Agent6","type":"main","index":0}],[{"node":"Edit Fields3","type":"main","index":0}]]},"Send a message2":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"AI Agent6":{"main":[[{"node":"Send a message2","type":"main","index":0}]]},"OpenAI Chat Model6":{"ai_languageModel":[[{"node":"AI Agent6","type":"ai_languageModel","index":0}]]},"File Webhook":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"AI Agent5","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}]]},"OpenAI Chat Model7":{"ai_languageModel":[[{"node":"V2","type":"ai_languageModel","index":0}]]},"If2":{"main":[[{"node":"If3","type":"main","index":0}],[{"node":"AI Agent7","type":"main","index":0}]]},"Send a message3":{"main":[[{"node":"Edit Fields4","type":"main","index":0}]]},"Edit Fields4":{"main":[[{"node":"Respond to Webhook2","type":"main","index":0}]]},"AI Agent8":{"main":[[{"node":"Send a message3","type":"main","index":0}]]},"OpenAI Chat Model8":{"ai_languageModel":[[{"node":"AI Agent8","type":"ai_languageModel","index":0}]]},"File Webhook1":{"main":[[{"node":"Extract from File2","type":"main","index":0}]]},"Extract from File2":{"main":[[{"node":"V2","type":"main","index":0}]]},"V2":{"main":[[{"node":"Code3","type":"main","index":0}]]},"Code3":{"main":[[{"node":"If2","type":"main","index":0}]]},"When clicking ‘Execute workflow’":{"main":[[{"node":"V","type":"main","index":0}]]},"AI Agent7":{"main":[[{"node":"Respond to Webhook3","type":"main","index":0}]]},"OpenAI Chat Model9":{"ai_languageModel":[[{"node":"AI Agent7","type":"ai_languageModel","index":0}]]},"If3":{"main":[[{"node":"Respond to Webhook4","type":"main","index":0}],[{"node":"AI Agent8","type":"main","index":0}]]},"OpenAI Chat Model10":{"ai_languageModel":[[{"node":"V","type":"ai_languageModel","index":0}]]},"If5":{"main":[[{"node":"If6","type":"main","index":0}],[{"node":"AI Agent10","type":"main","index":0}]]},"Send a message4":{"main":[[{"node":"Edit Fields5","type":"main","index":0}]]},"Edit Fields5":{"main":[[]]},"AI Agent9":{"main":[[{"node":"Send a message4","type":"main","index":0}]]},"OpenAI Chat Model11":{"ai_languageModel":[[{"node":"AI Agent9","type":"ai_languageModel","index":0}]]},"V":{"main":[[{"node":"Code4","type":"main","index":0}]]},"Code4":{"main":[[{"node":"If5","type":"main","index":0}]]},"AI Agent10":{"main":[[{"node":"Edit Fields7","type":"main","index":0}]]},"OpenAI Chat Model12":{"ai_languageModel":[[{"node":"AI Agent10","type":"ai_languageModel","index":0}]]},"If6":{"main":[[{"node":"Edit Fields8","type":"main","index":0}],[{"node":"AI Agent9","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"35e3db80-fcdb-4f96-9d9b-9b2144b6b667","triggerCount":2,"tags":[]}