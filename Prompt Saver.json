{"createdAt":"2025-07-18T07:14:23.424Z","updatedAt":"2025-07-25T07:37:14.583Z","id":"dunWRyQrD9eemSCl","name":"Prompt Saver","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-656,-144],"id":"8423d5b7-bf5d-4655-a0fd-3d49e06e45d5","name":"When clicking ‘Execute workflow’"},{"parameters":{"documentId":{"__rl":true,"value":"1gr3RCO8-d8G0sjGnBlP0saZXQcuYD4S3V7ggedenFRU","mode":"list","cachedResultName":"Agents","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gr3RCO8-d8G0sjGnBlP0saZXQcuYD4S3V7ggedenFRU/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1878421499,"mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gr3RCO8-d8G0sjGnBlP0saZXQcuYD4S3V7ggedenFRU/edit#gid=1878421499"},"filtersUI":{"values":[{"lookupColumn":"Processed for prompt","lookupValue":"no"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[-448,-144],"id":"2dc88d4d-392a-4a02-97bf-0da80cf8f832","name":"Get row(s) in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"WqHYSCJUHAwccGcv","name":"Gluagents Google Sheets"}}},{"parameters":{"operation":"get","workflowId":{"__rl":true,"value":"={{ $json.Workflow_id }}","mode":"id"},"requestOptions":{}},"type":"n8n-nodes-base.n8n","typeVersion":1,"position":[-224,-144],"id":"fde15ef1-51cc-4da4-b8c3-6872b9912eeb","name":"Get a workflow","credentials":{"n8nApi":{"id":"ErPdia6OfpeN2Y4H","name":"Shreyansh n8n account"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Extract sub-workflow IDs from main workflow data\nconst workflowData = $json;\nconst subWorkflowIds = [];\n\n// Collect sub-workflow IDs\nif (workflowData && workflowData.nodes) {\n  workflowData.nodes.forEach(node => {\n\n    // Execute Workflow node\n    if (node.type === 'n8n-nodes-base.executeWorkflow') {\n      let workflowId = node.parameters?.workflowId;\n      if (workflowId) {\n        workflowId = typeof workflowId === 'string' ? workflowId : workflowId.value;\n        if (workflowId) subWorkflowIds.push(workflowId);\n      }\n    }\n\n    // AI Agent Tool Workflow node\n    else if (node.type === '@n8n/n8n-nodes-langchain.toolWorkflow') {\n      let workflowId = node.parameters?.workflowId;\n      if (workflowId) {\n        workflowId = typeof workflowId === 'string' ? workflowId : workflowId.value;\n        if (workflowId) subWorkflowIds.push(workflowId);\n      }\n    }\n\n    // AI Agent direct reference\n    else if (node.type?.includes('langchain') && node.type.includes('agent')) {\n      if (node.parameters) {\n        Object.keys(node.parameters).forEach(paramKey => {\n          const param = node.parameters[paramKey];\n          if (param && typeof param === 'object' && param.value &&\n              (paramKey.toLowerCase().includes('workflow') || param.value.length > 10)) {\n            subWorkflowIds.push(param.value);\n          }\n        });\n      }\n    }\n  });\n}\n\n// Combine and deduplicate\nconst allWorkflowIds = [...new Set([workflowData.id, ...subWorkflowIds])];\n\n// ✅ Return a single object with an array (✅ allowed in current mode)\nreturn {\n  json: {\n    allWorkflowIds: allWorkflowIds\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[0,-144],"id":"b29d2b24-d822-471f-b361-d5a11f001827","name":"Code","alwaysOutputData":true},{"parameters":{"operation":"get","workflowId":{"__rl":true,"value":"={{ $json.allWorkflowIds }}","mode":"id"},"requestOptions":{}},"type":"n8n-nodes-base.n8n","typeVersion":1,"position":[672,-144],"id":"987279b2-f720-4f66-bd69-5c57b522e8a5","name":"Get a workflow1","credentials":{"n8nApi":{"id":"ErPdia6OfpeN2Y4H","name":"Shreyansh n8n account"}}},{"parameters":{"jsCode":"// Merge all \"allWorkflowIds\" arrays into a single flat array\nconst mergedIds = items.flatMap(item => item.json.allWorkflowIds);\n\n// Optional: Remove duplicates\nconst uniqueMergedIds = [...new Set(mergedIds)];\n\n// Return as a single output object\nreturn [\n  {\n    json: {\n      allWorkflowIds: uniqueMergedIds\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[224,-144],"id":"37b8e7d1-bf6c-4b27-9e89-c1c5f1cdcc0d","name":"Code1","alwaysOutputData":true},{"parameters":{"fieldToSplitOut":"allWorkflowIds","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[448,-144],"id":"8d376694-3c61-421e-96d9-80ec9ea322f2","name":"Split Out"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// n8n Code Node - AI Agent Node Extractor (Individual Entries per AI Agent)\n// This code creates separate entries for each AI agent node\n// Get the workflow data from input\nconst workflowData = $input.item.json;\n\n// Extract workflow ID and name\nconst workflowId = workflowData.id;\nconst workflowName = workflowData.name;\n\n// Filter nodes that are AI agents\nconst aiAgentNodes = workflowData.nodes.filter(node => \n  node.type === '@n8n/n8n-nodes-langchain.agent'\n);\n\n// Log for debugging\nconsole.log('Processing workflow:', workflowName);\nconsole.log('AI Agent Nodes Found:', aiAgentNodes.length);\n\n// Check if we have any AI agent nodes\nif (aiAgentNodes.length === 0) {\n  // No AI agent nodes found - return single object\n  return {\n    workflowId: workflowId,\n    workflowName: workflowName,\n    message: \"No AI agent nodes found in this workflow\",\n    totalNodes: workflowData.nodes.length,\n    aiAgentNodesCount: 0,\n    individualEntries: [] // Empty array for consistency\n  };\n}\n\n// Create individual entries for each AI agent node\nconst individualEntries = aiAgentNodes.map((node, index) => {\n  const systemMessage = node.parameters?.options?.systemMessage || 'No system message found';\n  \n  return {\n    workflowId: workflowId,\n    workflowName: workflowName,\n    nodeId: node.id,\n    nodeName: node.name,\n    nodeType: node.type,\n    systemMessage: systemMessage,\n    promptType: node.parameters?.promptType || null,\n    totalNodesInWorkflow: workflowData.nodes.length,\n    aiAgentNodesCountInWorkflow: aiAgentNodes.length,\n  };\n});\n\n// Return single object with array that can be split later\nreturn {\n  workflowId: workflowId,\n  workflowName: workflowName,\n  totalNodes: workflowData.nodes.length,\n  aiAgentNodesCount: aiAgentNodes.length,\n  // Array of individual entries for splitting\n  individualEntries: individualEntries\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[864,-144],"id":"eb9ef5f7-d49d-438b-a700-0790c11d0c7e","name":"Code2","alwaysOutputData":true},{"parameters":{"fieldToSplitOut":"individualEntries","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[1104,-144],"id":"e11ce195-cb31-4ca0-b3bd-e1f84ec62e35","name":"Split Out1"},{"parameters":{"folderId":"default","title":"={{ $json.workflowName  + \"#\" + $json.nodeName  }}"},"type":"n8n-nodes-base.googleDocs","typeVersion":2,"position":[1328,-144],"id":"ff72f862-b4a6-4ae8-8b72-34f27e41201a","name":"Create a document","credentials":{"googleDocsOAuth2Api":{"id":"T0uBlmGwFoQcaNzt","name":"Gluagents Google Docs"}}},{"parameters":{"operation":"update","documentURL":"={{ $json.id }}","actionsUi":{"actionFields":[{"action":"insert","text":"={{ $('Split Out1').item.json.systemMessage }}"}]}},"type":"n8n-nodes-base.googleDocs","typeVersion":2,"position":[1552,-144],"id":"fdbf6d3e-4642-4da9-a2ef-89720771f904","name":"Update a document","credentials":{"googleDocsOAuth2Api":{"id":"T0uBlmGwFoQcaNzt","name":"Gluagents Google Docs"}}},{"parameters":{"operation":"create","base":{"__rl":true,"value":"appDhxpnl9eqpJm7z","mode":"list","cachedResultName":"Agents","cachedResultUrl":"https://airtable.com/appDhxpnl9eqpJm7z"},"table":{"__rl":true,"value":"tbl2sxV7BDbjLEAhM","mode":"list","cachedResultName":"Prompts","cachedResultUrl":"https://airtable.com/appDhxpnl9eqpJm7z/tbl2sxV7BDbjLEAhM"},"columns":{"mappingMode":"defineBelow","value":{"Workflow Id":"={{ $('Split Out1').item.json.workflowId }}","Node Id":"={{ $('Split Out1').item.json.nodeId }}","Node name":"={{ $('Split Out1').item.json.nodeName }}","Doc link":"={{ \"https://docs.google.com/document/d/\" + $json.documentId }}","Workflow Name":"={{ $('Split Out1').item.json.workflowName }}","Doc Id":"={{ $json.documentId }}"},"matchingColumns":["Node Id"],"schema":[{"id":"Workflow Id","displayName":"Workflow Id","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Workflow Name","displayName":"Workflow Name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Node Id","displayName":"Node Id","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Node name","displayName":"Node name","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Doc link","displayName":"Doc link","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false},{"id":"Doc Id","displayName":"Doc Id","required":false,"defaultMatch":false,"canBeUsedToMatch":true,"display":true,"type":"string","readOnly":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.airtable","typeVersion":2.1,"position":[1760,-144],"id":"06910c5b-a926-4ba6-8c42-e55d2d05abba","name":"Create a record","credentials":{"airtableTokenApi":{"id":"LUV09oDP5v1QpIcn","name":"Airtable Personal Access Token account 2"}}},{"parameters":{"operation":"update","documentId":{"__rl":true,"value":"1gr3RCO8-d8G0sjGnBlP0saZXQcuYD4S3V7ggedenFRU","mode":"list","cachedResultName":"Agents","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gr3RCO8-d8G0sjGnBlP0saZXQcuYD4S3V7ggedenFRU/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":1878421499,"mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1gr3RCO8-d8G0sjGnBlP0saZXQcuYD4S3V7ggedenFRU/edit#gid=1878421499"},"columns":{"mappingMode":"defineBelow","value":{"Agents":"={{ $('Get row(s) in sheet').item.json.Agents }}","Workflow_id":"={{ $('Get row(s) in sheet').item.json.Workflow_id }}","Include":"={{ $('Get row(s) in sheet').item.json.Include }}","Agent_description":"={{ $('Get row(s) in sheet').item.json.Agent_description }}","Workflow_link":"={{ $('Get row(s) in sheet').item.json.Workflow_link }}","Image_link":"={{ $('Get row(s) in sheet').item.json.Image_link }}","Processed for prompt":"=yes"},"matchingColumns":["Workflow_id"],"schema":[{"id":"Agents","displayName":"Agents","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Workflow_id","displayName":"Workflow_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Include","displayName":"Include","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Agent_description","displayName":"Agent_description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Workflow_link","displayName":"Workflow_link","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Image_link","displayName":"Image_link","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Processed for prompt","displayName":"Processed for prompt","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"readOnly":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1968,-144],"id":"ace5aeb2-c5a2-45f1-b931-b9191fe5f341","name":"Update row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"WqHYSCJUHAwccGcv","name":"Gluagents Google Sheets"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Get row(s) in sheet","type":"main","index":0}]]},"Get row(s) in sheet":{"main":[[{"node":"Get a workflow","type":"main","index":0}]]},"Code":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Get a workflow":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Get a workflow1","type":"main","index":0}]]},"Get a workflow1":{"main":[[{"node":"Code2","type":"main","index":0}]]},"Code2":{"main":[[{"node":"Split Out1","type":"main","index":0}]]},"Split Out1":{"main":[[{"node":"Create a document","type":"main","index":0}]]},"Create a document":{"main":[[{"node":"Update a document","type":"main","index":0}]]},"Update a document":{"main":[[{"node":"Create a record","type":"main","index":0}]]},"Create a record":{"main":[[{"node":"Update row in sheet","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"536e9d8e-7f25-46bb-a489-00abcb58b601","triggerCount":0,"tags":[]}